(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();var Zs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ks(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var Us={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(d,t){((e,i)=>{d.exports=i()})(Zs,function e(){var i=typeof self<"u"?self:typeof window<"u"?window:i!==void 0?i:{},s,n=!i.document&&!!i.postMessage,h=i.IS_PAPA_WORKER||!1,a={},l=0,r={};function o(m){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(g){var b=C(g);b.chunkSize=parseInt(b.chunkSize),g.step||g.chunk||(b.chunkSize=null),this._handle=new y(b),(this._handle.streamer=this)._config=b}).call(this,m),this.parseChunk=function(g,b){var S=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<S){let F=this._config.newline;F||(A=this._config.quoteChar||'"',F=this._handle.guessLineEndings(g,A)),g=[...g.split(F).slice(S)].join(F)}this.isFirstChunk&&v(this._config.beforeFirstChunk)&&(A=this._config.beforeFirstChunk(g))!==void 0&&(g=A),this.isFirstChunk=!1,this._halted=!1;var S=this._partialLine+g,A=(this._partialLine="",this._handle.parse(S,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(g=A.meta.cursor,S=(this._finished||(this._partialLine=S.substring(g-this._baseIndex),this._baseIndex=g),A&&A.data&&(this._rowCount+=A.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),h)i.postMessage({results:A,workerId:r.WORKER_ID,finished:S});else if(v(this._config.chunk)&&!b){if(this._config.chunk(A,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=A=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(A.data),this._completeResults.errors=this._completeResults.errors.concat(A.errors),this._completeResults.meta=A.meta),this._completed||!S||!v(this._config.complete)||A&&A.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),S||A&&A.meta.paused||this._nextChunk(),A}this._halted=!0},this._sendError=function(g){v(this._config.error)?this._config.error(g):h&&this._config.error&&i.postMessage({workerId:r.WORKER_ID,error:g,finished:!1})}}function c(m){var g;(m=m||{}).chunkSize||(m.chunkSize=r.RemoteChunkSize),o.call(this,m),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(b){this._input=b,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(g=new XMLHttpRequest,this._config.withCredentials&&(g.withCredentials=this._config.withCredentials),n||(g.onload=T(this._chunkLoaded,this),g.onerror=T(this._chunkError,this)),g.open(this._config.downloadRequestBody?"POST":"GET",this._input,!n),this._config.downloadRequestHeaders){var b,S=this._config.downloadRequestHeaders;for(b in S)g.setRequestHeader(b,S[b])}var A;this._config.chunkSize&&(A=this._start+this._config.chunkSize-1,g.setRequestHeader("Range","bytes="+this._start+"-"+A));try{g.send(this._config.downloadRequestBody)}catch(F){this._chunkError(F.message)}n&&g.status===0&&this._chunkError()}},this._chunkLoaded=function(){g.readyState===4&&(g.status<200||400<=g.status?this._chunkError():(this._start+=this._config.chunkSize||g.responseText.length,this._finished=!this._config.chunkSize||this._start>=(b=>(b=b.getResponseHeader("Content-Range"))!==null?parseInt(b.substring(b.lastIndexOf("/")+1)):-1)(g),this.parseChunk(g.responseText)))},this._chunkError=function(b){b=g.statusText||b,this._sendError(new Error(b))}}function u(m){(m=m||{}).chunkSize||(m.chunkSize=r.LocalChunkSize),o.call(this,m);var g,b,S=typeof FileReader<"u";this.stream=function(A){this._input=A,b=A.slice||A.webkitSlice||A.mozSlice,S?((g=new FileReader).onload=T(this._chunkLoaded,this),g.onerror=T(this._chunkError,this)):g=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var A=this._input,F=(this._config.chunkSize&&(F=Math.min(this._start+this._config.chunkSize,this._input.size),A=b.call(A,this._start,F)),g.readAsText(A,this._config.encoding));S||this._chunkLoaded({target:{result:F}})},this._chunkLoaded=function(A){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(A.target.result)},this._chunkError=function(){this._sendError(g.error)}}function p(m){var g;o.call(this,m=m||{}),this.stream=function(b){return g=b,this._nextChunk()},this._nextChunk=function(){var b,S;if(!this._finished)return b=this._config.chunkSize,g=b?(S=g.substring(0,b),g.substring(b)):(S=g,""),this._finished=!g,this.parseChunk(S)}}function f(m){o.call(this,m=m||{});var g=[],b=!0,S=!1;this.pause=function(){o.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){o.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(A){this._input=A,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){S&&g.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),g.length?this.parseChunk(g.shift()):b=!0},this._streamData=T(function(A){try{g.push(typeof A=="string"?A:A.toString(this._config.encoding)),b&&(b=!1,this._checkIsFinished(),this.parseChunk(g.shift()))}catch(F){this._streamError(F)}},this),this._streamError=T(function(A){this._streamCleanUp(),this._sendError(A)},this),this._streamEnd=T(function(){this._streamCleanUp(),S=!0,this._streamData("")},this),this._streamCleanUp=T(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function y(m){var g,b,S,A,F=Math.pow(2,53),W=-F,D=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,Z=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,k=this,H=0,I=0,P=!1,B=!1,N=[],z={data:[],errors:[],meta:{}};function K(O){return m.skipEmptyLines==="greedy"?O.join("").trim()==="":O.length===1&&O[0].length===0}function V(){if(z&&S&&(tt("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+r.DefaultDelimiter+"'"),S=!1),m.skipEmptyLines&&(z.data=z.data.filter(function($){return!K($)})),G()){let $=function(et,J){v(m.transformHeader)&&(et=m.transformHeader(et,J)),N.push(et)};var L=$;if(z)if(Array.isArray(z.data[0])){for(var O=0;G()&&O<z.data.length;O++)z.data[O].forEach($);z.data.splice(0,1)}else z.data.forEach($)}function q($,et){for(var J=m.header?{}:[],Y=0;Y<$.length;Y++){var U=Y,ht=$[Y],ht=((X,Q)=>(st=>(m.dynamicTypingFunction&&m.dynamicTyping[st]===void 0&&(m.dynamicTyping[st]=m.dynamicTypingFunction(st)),(m.dynamicTyping[st]||m.dynamicTyping)===!0))(X)?Q==="true"||Q==="TRUE"||Q!=="false"&&Q!=="FALSE"&&((st=>{if(D.test(st)&&(st=parseFloat(st),W<st&&st<F))return 1})(Q)?parseFloat(Q):Z.test(Q)?new Date(Q):Q===""?null:Q):Q)(U=m.header?Y>=N.length?"__parsed_extra":N[Y]:U,ht=m.transform?m.transform(ht,U):ht);U==="__parsed_extra"?(J[U]=J[U]||[],J[U].push(ht)):J[U]=ht}return m.header&&(Y>N.length?tt("FieldMismatch","TooManyFields","Too many fields: expected "+N.length+" fields but parsed "+Y,I+et):Y<N.length&&tt("FieldMismatch","TooFewFields","Too few fields: expected "+N.length+" fields but parsed "+Y,I+et)),J}var j;z&&(m.header||m.dynamicTyping||m.transform)&&(j=1,!z.data.length||Array.isArray(z.data[0])?(z.data=z.data.map(q),j=z.data.length):z.data=q(z.data,0),m.header&&z.meta&&(z.meta.fields=N),I+=j)}function G(){return m.header&&N.length===0}function tt(O,q,j,L){O={type:O,code:q,message:j},L!==void 0&&(O.row=L),z.errors.push(O)}v(m.step)&&(A=m.step,m.step=function(O){z=O,G()?V():(V(),z.data.length!==0&&(H+=O.data.length,m.preview&&H>m.preview?b.abort():(z.data=z.data[0],A(z,k))))}),this.parse=function(O,q,j){var L=m.quoteChar||'"',L=(m.newline||(m.newline=this.guessLineEndings(O,L)),S=!1,m.delimiter?v(m.delimiter)&&(m.delimiter=m.delimiter(O),z.meta.delimiter=m.delimiter):((L=(($,et,J,Y,U)=>{var ht,X,Q,st;U=U||[",","	","|",";",r.RECORD_SEP,r.UNIT_SEP];for(var Kt=0;Kt<U.length;Kt++){for(var Et,ge=U[Kt],lt=0,Ct=0,nt=0,pt=(Q=void 0,new M({comments:Y,delimiter:ge,newline:et,preview:10}).parse($)),kt=0;kt<pt.data.length;kt++)J&&K(pt.data[kt])?nt++:(Et=pt.data[kt].length,Ct+=Et,Q===void 0?Q=Et:0<Et&&(lt+=Math.abs(Et-Q),Q=Et));0<pt.data.length&&(Ct/=pt.data.length-nt),(X===void 0||lt<=X)&&(st===void 0||st<Ct)&&1.99<Ct&&(X=lt,ht=ge,st=Ct)}return{successful:!!(m.delimiter=ht),bestDelimiter:ht}})(O,m.newline,m.skipEmptyLines,m.comments,m.delimitersToGuess)).successful?m.delimiter=L.bestDelimiter:(S=!0,m.delimiter=r.DefaultDelimiter),z.meta.delimiter=m.delimiter),C(m));return m.preview&&m.header&&L.preview++,g=O,b=new M(L),z=b.parse(g,q,j),V(),P?{meta:{paused:!0}}:z||{meta:{paused:!1}}},this.paused=function(){return P},this.pause=function(){P=!0,b.abort(),g=v(m.chunk)?"":g.substring(b.getCharIndex())},this.resume=function(){k.streamer._halted?(P=!1,k.streamer.parseChunk(g,!0)):setTimeout(k.resume,3)},this.aborted=function(){return B},this.abort=function(){B=!0,b.abort(),z.meta.aborted=!0,v(m.complete)&&m.complete(z),g=""},this.guessLineEndings=function($,L){$=$.substring(0,1048576);var L=new RegExp(x(L)+"([^]*?)"+x(L),"gm"),j=($=$.replace(L,"")).split("\r"),L=$.split(`
`),$=1<L.length&&L[0].length<j[0].length;if(j.length===1||$)return`
`;for(var et=0,J=0;J<j.length;J++)j[J][0]===`
`&&et++;return et>=j.length/2?`\r
`:"\r"}}function x(m){return m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function M(m){var g=(m=m||{}).delimiter,b=m.newline,S=m.comments,A=m.step,F=m.preview,W=m.fastMode,D=null,Z=!1,k=m.quoteChar==null?'"':m.quoteChar,H=k;if(m.escapeChar!==void 0&&(H=m.escapeChar),(typeof g!="string"||-1<r.BAD_DELIMITERS.indexOf(g))&&(g=","),S===g)throw new Error("Comment character same as delimiter");S===!0?S="#":(typeof S!="string"||-1<r.BAD_DELIMITERS.indexOf(S))&&(S=!1),b!==`
`&&b!=="\r"&&b!==`\r
`&&(b=`
`);var I=0,P=!1;this.parse=function(B,N,z){if(typeof B!="string")throw new Error("Input must be a string");var K=B.length,V=g.length,G=b.length,tt=S.length,O=v(A),q=[],j=[],L=[],$=I=0;if(!B)return lt();if(W||W!==!1&&B.indexOf(k)===-1){for(var et=B.split(b),J=0;J<et.length;J++){if(L=et[J],I+=L.length,J!==et.length-1)I+=b.length;else if(z)return lt();if(!S||L.substring(0,tt)!==S){if(O){if(q=[],st(L.split(g)),Ct(),P)return lt()}else st(L.split(g));if(F&&F<=J)return q=q.slice(0,F),lt(!0)}}return lt()}for(var Y=B.indexOf(g,I),U=B.indexOf(b,I),ht=new RegExp(x(H)+x(k),"g"),X=B.indexOf(k,I);;)if(B[I]===k)for(X=I,I++;;){if((X=B.indexOf(k,X+1))===-1)return z||j.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:q.length,index:I}),Et();if(X===K-1)return Et(B.substring(I,X).replace(ht,k));if(k===H&&B[X+1]===H)X++;else if(k===H||X===0||B[X-1]!==H){Y!==-1&&Y<X+1&&(Y=B.indexOf(g,X+1));var Q=Kt((U=U!==-1&&U<X+1?B.indexOf(b,X+1):U)===-1?Y:Math.min(Y,U));if(B.substr(X+1+Q,V)===g){L.push(B.substring(I,X).replace(ht,k)),B[I=X+1+Q+V]!==k&&(X=B.indexOf(k,I)),Y=B.indexOf(g,I),U=B.indexOf(b,I);break}if(Q=Kt(U),B.substring(X+1+Q,X+1+Q+G)===b){if(L.push(B.substring(I,X).replace(ht,k)),ge(X+1+Q+G),Y=B.indexOf(g,I),X=B.indexOf(k,I),O&&(Ct(),P))return lt();if(F&&q.length>=F)return lt(!0);break}j.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:q.length,index:I}),X++}}else if(S&&L.length===0&&B.substring(I,I+tt)===S){if(U===-1)return lt();I=U+G,U=B.indexOf(b,I),Y=B.indexOf(g,I)}else if(Y!==-1&&(Y<U||U===-1))L.push(B.substring(I,Y)),I=Y+V,Y=B.indexOf(g,I);else{if(U===-1)break;if(L.push(B.substring(I,U)),ge(U+G),O&&(Ct(),P))return lt();if(F&&q.length>=F)return lt(!0)}return Et();function st(nt){q.push(nt),$=I}function Kt(nt){var pt=0;return pt=nt!==-1&&(nt=B.substring(X+1,nt))&&nt.trim()===""?nt.length:pt}function Et(nt){return z||(nt===void 0&&(nt=B.substring(I)),L.push(nt),I=K,st(L),O&&Ct()),lt()}function ge(nt){I=nt,st(L),L=[],U=B.indexOf(b,I)}function lt(nt){if(m.header&&!N&&q.length&&!Z){var pt=q[0],kt=Object.create(null),ci=new Set(pt);let Vi=!1;for(let Qt=0;Qt<pt.length;Qt++){let Ft=pt[Qt];if(kt[Ft=v(m.transformHeader)?m.transformHeader(Ft,Qt):Ft]){let xe,Wi=kt[Ft];for(;xe=Ft+"_"+Wi,Wi++,ci.has(xe););ci.add(xe),pt[Qt]=xe,kt[Ft]++,Vi=!0,(D=D===null?{}:D)[xe]=Ft}else kt[Ft]=1,pt[Qt]=Ft;ci.add(Ft)}Vi&&console.warn("Duplicate headers found and renamed."),Z=!0}return{data:q,errors:j,meta:{delimiter:g,linebreak:b,aborted:P,truncated:!!nt,cursor:$+(N||0),renamedHeaders:D}}}function Ct(){A(lt()),q=[],j=[]}},this.abort=function(){P=!0},this.getCharIndex=function(){return I}}function E(m){var g=m.data,b=a[g.workerId],S=!1;if(g.error)b.userError(g.error,g.file);else if(g.results&&g.results.data){var A={abort:function(){S=!0,R(g.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:_,resume:_};if(v(b.userStep)){for(var F=0;F<g.results.data.length&&(b.userStep({data:g.results.data[F],errors:g.results.errors,meta:g.results.meta},A),!S);F++);delete g.results}else v(b.userChunk)&&(b.userChunk(g.results,A,g.file),delete g.results)}g.finished&&!S&&R(g.workerId,g.results)}function R(m,g){var b=a[m];v(b.userComplete)&&b.userComplete(g),b.terminate(),delete a[m]}function _(){throw new Error("Not implemented.")}function C(m){if(typeof m!="object"||m===null)return m;var g,b=Array.isArray(m)?[]:{};for(g in m)b[g]=C(m[g]);return b}function T(m,g){return function(){m.apply(g,arguments)}}function v(m){return typeof m=="function"}return r.parse=function(m,g){var b=(g=g||{}).dynamicTyping||!1;if(v(b)&&(g.dynamicTypingFunction=b,b={}),g.dynamicTyping=b,g.transform=!!v(g.transform)&&g.transform,!g.worker||!r.WORKERS_SUPPORTED)return b=null,r.NODE_STREAM_INPUT,typeof m=="string"?(m=(S=>S.charCodeAt(0)!==65279?S:S.slice(1))(m),b=new(g.download?c:p)(g)):m.readable===!0&&v(m.read)&&v(m.on)?b=new f(g):(i.File&&m instanceof File||m instanceof Object)&&(b=new u(g)),b.stream(m);(b=(()=>{var S;return!!r.WORKERS_SUPPORTED&&(S=(()=>{var A=i.URL||i.webkitURL||null,F=e.toString();return r.BLOB_URL||(r.BLOB_URL=A.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",F,")();"],{type:"text/javascript"})))})(),(S=new i.Worker(S)).onmessage=E,S.id=l++,a[S.id]=S)})()).userStep=g.step,b.userChunk=g.chunk,b.userComplete=g.complete,b.userError=g.error,g.step=v(g.step),g.chunk=v(g.chunk),g.complete=v(g.complete),g.error=v(g.error),delete g.worker,b.postMessage({input:m,config:g,workerId:b.id})},r.unparse=function(m,g){var b=!1,S=!0,A=",",F=`\r
`,W='"',D=W+W,Z=!1,k=null,H=!1,I=((()=>{if(typeof g=="object"){if(typeof g.delimiter!="string"||r.BAD_DELIMITERS.filter(function(N){return g.delimiter.indexOf(N)!==-1}).length||(A=g.delimiter),typeof g.quotes!="boolean"&&typeof g.quotes!="function"&&!Array.isArray(g.quotes)||(b=g.quotes),typeof g.skipEmptyLines!="boolean"&&typeof g.skipEmptyLines!="string"||(Z=g.skipEmptyLines),typeof g.newline=="string"&&(F=g.newline),typeof g.quoteChar=="string"&&(W=g.quoteChar),typeof g.header=="boolean"&&(S=g.header),Array.isArray(g.columns)){if(g.columns.length===0)throw new Error("Option columns is empty");k=g.columns}g.escapeChar!==void 0&&(D=g.escapeChar+W),g.escapeFormulae instanceof RegExp?H=g.escapeFormulae:typeof g.escapeFormulae=="boolean"&&g.escapeFormulae&&(H=/^[=+\-@\t\r].*$/)}})(),new RegExp(x(W),"g"));if(typeof m=="string"&&(m=JSON.parse(m)),Array.isArray(m)){if(!m.length||Array.isArray(m[0]))return P(null,m,Z);if(typeof m[0]=="object")return P(k||Object.keys(m[0]),m,Z)}else if(typeof m=="object")return typeof m.data=="string"&&(m.data=JSON.parse(m.data)),Array.isArray(m.data)&&(m.fields||(m.fields=m.meta&&m.meta.fields||k),m.fields||(m.fields=Array.isArray(m.data[0])?m.fields:typeof m.data[0]=="object"?Object.keys(m.data[0]):[]),Array.isArray(m.data[0])||typeof m.data[0]=="object"||(m.data=[m.data])),P(m.fields||[],m.data||[],Z);throw new Error("Unable to serialize unrecognized input");function P(N,z,K){var V="",G=(typeof N=="string"&&(N=JSON.parse(N)),typeof z=="string"&&(z=JSON.parse(z)),Array.isArray(N)&&0<N.length),tt=!Array.isArray(z[0]);if(G&&S){for(var O=0;O<N.length;O++)0<O&&(V+=A),V+=B(N[O],O);0<z.length&&(V+=F)}for(var q=0;q<z.length;q++){var j=(G?N:z[q]).length,L=!1,$=G?Object.keys(z[q]).length===0:z[q].length===0;if(K&&!G&&(L=K==="greedy"?z[q].join("").trim()==="":z[q].length===1&&z[q][0].length===0),K==="greedy"&&G){for(var et=[],J=0;J<j;J++){var Y=tt?N[J]:J;et.push(z[q][Y])}L=et.join("").trim()===""}if(!L){for(var U=0;U<j;U++){0<U&&!$&&(V+=A);var ht=G&&tt?N[U]:U;V+=B(z[q][ht],U)}q<z.length-1&&(!K||0<j&&!$)&&(V+=F)}}return V}function B(N,z){var K,V;return N==null?"":N.constructor===Date?JSON.stringify(N).slice(1,25):(V=!1,H&&typeof N=="string"&&H.test(N)&&(N="'"+N,V=!0),K=N.toString().replace(I,D),(V=V||b===!0||typeof b=="function"&&b(N,z)||Array.isArray(b)&&b[z]||((G,tt)=>{for(var O=0;O<tt.length;O++)if(-1<G.indexOf(tt[O]))return!0;return!1})(K,r.BAD_DELIMITERS)||-1<K.indexOf(A)||K.charAt(0)===" "||K.charAt(K.length-1)===" ")?W+K+W:K)}},r.RECORD_SEP="",r.UNIT_SEP="",r.BYTE_ORDER_MARK="\uFEFF",r.BAD_DELIMITERS=["\r",`
`,'"',r.BYTE_ORDER_MARK],r.WORKERS_SUPPORTED=!n&&!!i.Worker,r.NODE_STREAM_INPUT=1,r.LocalChunkSize=10485760,r.RemoteChunkSize=5242880,r.DefaultDelimiter=",",r.Parser=M,r.ParserHandle=y,r.NetworkStreamer=c,r.FileStreamer=u,r.StringStreamer=p,r.ReadableStreamStreamer=f,i.jQuery&&((s=i.jQuery).fn.parse=function(m){var g=m.config||{},b=[];return this.each(function(F){if(!(s(this).prop("tagName").toUpperCase()==="INPUT"&&s(this).attr("type").toLowerCase()==="file"&&i.FileReader)||!this.files||this.files.length===0)return!0;for(var W=0;W<this.files.length;W++)b.push({file:this.files[W],inputElem:this,instanceConfig:s.extend({},g)})}),S(),this;function S(){if(b.length===0)v(m.complete)&&m.complete();else{var F,W,D,Z,k=b[0];if(v(m.before)){var H=m.before(k.file,k.inputElem);if(typeof H=="object"){if(H.action==="abort")return F="AbortError",W=k.file,D=k.inputElem,Z=H.reason,void(v(m.error)&&m.error({name:F},W,D,Z));if(H.action==="skip")return void A();typeof H.config=="object"&&(k.instanceConfig=s.extend(k.instanceConfig,H.config))}else if(H==="skip")return void A()}var I=k.instanceConfig.complete;k.instanceConfig.complete=function(P){v(I)&&I(P,k.file,k.inputElem),A()},r.parse(k.file,k.instanceConfig)}}function A(){b.splice(0,1),S()}}),h&&(i.onmessage=function(m){m=m.data,r.WORKER_ID===void 0&&m&&(r.WORKER_ID=m.workerId),typeof m.input=="string"?i.postMessage({workerId:r.WORKER_ID,results:r.parse(m.input,m.config),finished:!0}):(i.File&&m.input instanceof File||m.input instanceof Object)&&(m=r.parse(m.input,m.config))&&i.postMessage({workerId:r.WORKER_ID,results:m,finished:!0})}),(c.prototype=Object.create(o.prototype)).constructor=c,(u.prototype=Object.create(o.prototype)).constructor=u,(p.prototype=Object.create(p.prototype)).constructor=p,(f.prototype=Object.create(o.prototype)).constructor=f,r})})(Us);var Qs=Us.exports;const Bi=Ks(Qs);class tn{constructor(){this.datasets={}}register(t,e){this.datasets[t]=e}get(t){return this.datasets[t]}async loadCsv(t){const i=await(await fetch(t)).text();return Bi.parse(i,{header:!0,dynamicTyping:!0}).data.filter(n=>Object.keys(n).length>0)}async loadJson(t){return(await fetch(t)).json()}}class en{constructor(){this.contracts=new Map,this.bootstrap()}bootstrap(){[{id:"RoadwayTopology",name:"Roadway Topology",required_roles:[{roleKey:"node_id",label:"Node id",dataType:"string",description:"Unique node id",defaultField:"id"},{roleKey:"node_name",label:"Node name",dataType:"string",defaultField:"name"},{roleKey:"node_pos",label:"Node position",dataType:"vec3",defaultField:"position"},{roleKey:"edge_id",label:"Edge id",dataType:"string",defaultField:"id"},{roleKey:"from_node",label:"From",dataType:"string",defaultField:"source"},{roleKey:"to_node",label:"To",dataType:"string",defaultField:"target"}],binding_requirements:[],structure_kind:"Graph",facet_capabilities:[{type:"Graph",label:"Graph view",outputType:"RoadwayGraph",requires:["node_id","edge_id"]}]},{id:"RoadwayGeometry",name:"Roadway Geometry",required_roles:[{roleKey:"mesh_part_id",label:"Mesh part name",dataType:"string",defaultField:"name"},{roleKey:"topo_ref_id",label:"Topo ref id",dataType:"string",defaultField:"name"}],binding_requirements:[{fromRoleKey:"topo_ref_id",toContractId:"RoadwayTopology",toRoleKey:"edge_id",description:"map mesh to topo"}],structure_kind:"ModelLibrary",facet_capabilities:[{type:"MeshParts",label:"Mesh parts",outputType:"RoadwayMeshParts"}]},{id:"SensorStationRegistry",name:"Sensor Registry",required_roles:[{roleKey:"sensor_id",label:"Sensor id",dataType:"string",defaultField:"sensorID"},{roleKey:"x",label:"X",dataType:"number",defaultField:"x"},{roleKey:"y",label:"Y",dataType:"number",defaultField:"y"},{roleKey:"z",label:"Z",dataType:"number",defaultField:"z"},{roleKey:"roadway_node_ref",label:"Roadway node",dataType:"string",defaultField:"roadwayID"}],binding_requirements:[{fromRoleKey:"roadway_node_ref",toContractId:"RoadwayTopology",toRoleKey:"node_id",description:"anchor sensors onto roadway nodes"}],structure_kind:"Table",facet_capabilities:[{type:"Registry",label:"Registry table",outputType:"SensorRegistry"},{type:"Points",label:"Points3D",outputType:"SensorPoints3D",requires:["x","y","z"]}]},{id:"SensorReadingTimeSeries",name:"Sensor Time Series",required_roles:[{roleKey:"sensor_id",label:"Sensor id",dataType:"string",defaultField:"sensorID"},{roleKey:"timestamp",label:"Timestamp",dataType:"datetime",defaultField:"time"},{roleKey:"value",label:"Value",dataType:"number",defaultField:"value"}],binding_requirements:[{fromRoleKey:"sensor_id",toContractId:"SensorStationRegistry",toRoleKey:"sensor_id",description:"link readings to registry rows"}],structure_kind:"Table",facet_capabilities:[{type:"Series",label:"Series",outputType:"SensorDataset",requires:["sensor_id","timestamp","value"]},{type:"Snapshot",label:"Snapshot",outputType:"SensorDataset",requires:["sensor_id","timestamp","value"]},{type:"Value",label:"Latest value",outputType:"SensorDataset",requires:["sensor_id","timestamp","value"]}]},{id:"ModelLibrary",name:"Model Library",required_roles:[{roleKey:"model_id",label:"Model id",dataType:"string",defaultField:"name"},{roleKey:"model_uri",label:"Model URI",dataType:"string",defaultField:"uri"}],binding_requirements:[],structure_kind:"ModelLibrary",facet_capabilities:[{type:"ModelSet",label:"Models",outputType:"ModelLibrary"}]}].forEach(e=>this.contracts.set(e.id,e))}list(){return Array.from(this.contracts.values())}get(t){return this.contracts.get(t)}}const pe=new en;/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Vs="161",Li=0,sn=1,Hi=1,$i=100,Gi=204,Xi=205,Yi=3,Ws=0,Hs=300,Ji=1e3,Fe=1001,Zi=1002,Ki=1003,nn=1006,rn=1008,an=1009,on=1014,hn=1015,ln=1020,cn=1023,di=1026,Qi=1027,dn=3e3,ui=3001,un=0,ii="",zt="srgb",Oi="srgb-linear",pn="display-p3",$s="display-p3-linear",Di="linear",ts="srgb",es="rec709",is="p3",te=7680,ss=519,fn=515,ns=35044,Re=2e3,rs=2001;class oi{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const s=this._listeners[t];if(s!==void 0){const n=s.indexOf(e);n!==-1&&s.splice(n,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners[t.type];if(i!==void 0){t.target=this;const s=i.slice(0);for(let n=0,h=s.length;n<h;n++)s[n].call(this,t);t.target=null}}}const ct=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function ze(){const d=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ct[d&255]+ct[d>>8&255]+ct[d>>16&255]+ct[d>>24&255]+"-"+ct[t&255]+ct[t>>8&255]+"-"+ct[t>>16&15|64]+ct[t>>24&255]+"-"+ct[e&63|128]+ct[e>>8&255]+"-"+ct[e>>16&255]+ct[e>>24&255]+ct[i&255]+ct[i>>8&255]+ct[i>>16&255]+ct[i>>24&255]).toLowerCase()}function mt(d,t,e){return Math.max(t,Math.min(e,d))}function mn(d,t){return(d%t+t)%t}function pi(d,t,e){return(1-e)*d+e*t}function be(d,t){switch(t.constructor){case Float32Array:return d;case Uint32Array:return d/4294967295;case Uint16Array:return d/65535;case Uint8Array:return d/255;case Int32Array:return Math.max(d/2147483647,-1);case Int16Array:return Math.max(d/32767,-1);case Int8Array:return Math.max(d/127,-1);default:throw new Error("Invalid component type.")}}function ft(d,t){switch(t.constructor){case Float32Array:return d;case Uint32Array:return Math.round(d*4294967295);case Uint16Array:return Math.round(d*65535);case Uint8Array:return Math.round(d*255);case Int32Array:return Math.round(d*2147483647);case Int16Array:return Math.round(d*32767);case Int8Array:return Math.round(d*127);default:throw new Error("Invalid component type.")}}class ut{constructor(t=0,e=0){ut.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(mt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),n=this.x-t.x,h=this.y-t.y;return this.x=n*i-h*s+t.x,this.y=n*s+h*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class $t{constructor(t,e,i,s,n,h,a,l,r){$t.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,i,s,n,h,a,l,r)}set(t,e,i,s,n,h,a,l,r){const o=this.elements;return o[0]=t,o[1]=s,o[2]=a,o[3]=e,o[4]=n,o[5]=l,o[6]=i,o[7]=h,o[8]=r,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,n=this.elements,h=i[0],a=i[3],l=i[6],r=i[1],o=i[4],c=i[7],u=i[2],p=i[5],f=i[8],y=s[0],x=s[3],M=s[6],E=s[1],R=s[4],_=s[7],C=s[2],T=s[5],v=s[8];return n[0]=h*y+a*E+l*C,n[3]=h*x+a*R+l*T,n[6]=h*M+a*_+l*v,n[1]=r*y+o*E+c*C,n[4]=r*x+o*R+c*T,n[7]=r*M+o*_+c*v,n[2]=u*y+p*E+f*C,n[5]=u*x+p*R+f*T,n[8]=u*M+p*_+f*v,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],h=t[4],a=t[5],l=t[6],r=t[7],o=t[8];return e*h*o-e*a*r-i*n*o+i*a*l+s*n*r-s*h*l}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],h=t[4],a=t[5],l=t[6],r=t[7],o=t[8],c=o*h-a*r,u=a*l-o*n,p=r*n-h*l,f=e*c+i*u+s*p;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/f;return t[0]=c*y,t[1]=(s*r-o*i)*y,t[2]=(a*i-s*h)*y,t[3]=u*y,t[4]=(o*e-s*l)*y,t[5]=(s*n-a*e)*y,t[6]=p*y,t[7]=(i*l-r*e)*y,t[8]=(h*e-i*n)*y,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,n,h,a){const l=Math.cos(n),r=Math.sin(n);return this.set(i*l,i*r,-i*(l*h+r*a)+h+t,-s*r,s*l,-s*(-r*h+l*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(fi.makeScale(t,e)),this}rotate(t){return this.premultiply(fi.makeRotation(-t)),this}translate(t,e){return this.premultiply(fi.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<9;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const fi=new $t;function yn(d){for(let t=d.length-1;t>=0;--t)if(d[t]>=65535)return!0;return!1}function as(d){return document.createElementNS("http://www.w3.org/1999/xhtml",d)}const os={};function si(d){d in os||(os[d]=!0,console.warn(d))}const hs=new $t().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),ls=new $t().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),ke={[Oi]:{transfer:Di,primaries:es,toReference:d=>d,fromReference:d=>d},[zt]:{transfer:ts,primaries:es,toReference:d=>d.convertSRGBToLinear(),fromReference:d=>d.convertLinearToSRGB()},[$s]:{transfer:Di,primaries:is,toReference:d=>d.applyMatrix3(ls),fromReference:d=>d.applyMatrix3(hs)},[pn]:{transfer:ts,primaries:is,toReference:d=>d.convertSRGBToLinear().applyMatrix3(ls),fromReference:d=>d.applyMatrix3(hs).convertLinearToSRGB()}},gn=new Set([Oi,$s]),St={enabled:!0,_workingColorSpace:Oi,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(d){if(!gn.has(d))throw new Error(`Unsupported working color space, "${d}".`);this._workingColorSpace=d},convert:function(d,t,e){if(this.enabled===!1||t===e||!t||!e)return d;const i=ke[t].toReference,s=ke[e].fromReference;return s(i(d))},fromWorkingColorSpace:function(d,t){return this.convert(d,this._workingColorSpace,t)},toWorkingColorSpace:function(d,t){return this.convert(d,t,this._workingColorSpace)},getPrimaries:function(d){return ke[d].primaries},getTransfer:function(d){return d===ii?Di:ke[d].transfer}};function fe(d){return d<.04045?d*.0773993808:Math.pow(d*.9478672986+.0521327014,2.4)}function mi(d){return d<.0031308?d*12.92:1.055*Math.pow(d,.41666)-.055}let ee;class xn{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{ee===void 0&&(ee=as("canvas")),ee.width=t.width,ee.height=t.height;const i=ee.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=ee}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=as("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const s=i.getImageData(0,0,t.width,t.height),n=s.data;for(let h=0;h<n.length;h++)n[h]=fe(n[h]/255)*255;return i.putImageData(s,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(fe(e[i]/255)*255):e[i]=fe(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let bn=0;class wn{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:bn++}),this.uuid=ze(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let n;if(Array.isArray(s)){n=[];for(let h=0,a=s.length;h<a;h++)s[h].isDataTexture?n.push(yi(s[h].image)):n.push(yi(s[h]))}else n=yi(s);i.url=n}return e||(t.images[this.uuid]=i),i}}function yi(d){return typeof HTMLImageElement<"u"&&d instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&d instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&d instanceof ImageBitmap?xn.getDataURL(d):d.data?{data:Array.from(d.data),width:d.width,height:d.height,type:d.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Mn=0;class Ht extends oi{constructor(t=Ht.DEFAULT_IMAGE,e=Ht.DEFAULT_MAPPING,i=Fe,s=Fe,n=nn,h=rn,a=cn,l=an,r=Ht.DEFAULT_ANISOTROPY,o=ii){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Mn++}),this.uuid=ze(),this.name="",this.source=new wn(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=n,this.minFilter=h,this.anisotropy=r,this.format=a,this.internalFormat=null,this.type=l,this.offset=new ut(0,0),this.repeat=new ut(1,1),this.center=new ut(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new $t,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof o=="string"?this.colorSpace=o:(si("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=o===ui?zt:ii),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Hs)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Ji:t.x=t.x-Math.floor(t.x);break;case Fe:t.x=t.x<0?0:1;break;case Zi:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Ji:t.y=t.y-Math.floor(t.y);break;case Fe:t.y=t.y<0?0:1;break;case Zi:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return si("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===zt?ui:dn}set encoding(t){si("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===ui?zt:ii}}Ht.DEFAULT_IMAGE=null;Ht.DEFAULT_MAPPING=Hs;Ht.DEFAULT_ANISOTROPY=1;class Ee{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerpFlat(t,e,i,s,n,h,a){let l=i[s+0],r=i[s+1],o=i[s+2],c=i[s+3];const u=n[h+0],p=n[h+1],f=n[h+2],y=n[h+3];if(a===0){t[e+0]=l,t[e+1]=r,t[e+2]=o,t[e+3]=c;return}if(a===1){t[e+0]=u,t[e+1]=p,t[e+2]=f,t[e+3]=y;return}if(c!==y||l!==u||r!==p||o!==f){let x=1-a;const M=l*u+r*p+o*f+c*y,E=M>=0?1:-1,R=1-M*M;if(R>Number.EPSILON){const C=Math.sqrt(R),T=Math.atan2(C,M*E);x=Math.sin(x*T)/C,a=Math.sin(a*T)/C}const _=a*E;if(l=l*x+u*_,r=r*x+p*_,o=o*x+f*_,c=c*x+y*_,x===1-a){const C=1/Math.sqrt(l*l+r*r+o*o+c*c);l*=C,r*=C,o*=C,c*=C}}t[e]=l,t[e+1]=r,t[e+2]=o,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,n,h){const a=i[s],l=i[s+1],r=i[s+2],o=i[s+3],c=n[h],u=n[h+1],p=n[h+2],f=n[h+3];return t[e]=a*f+o*c+l*p-r*u,t[e+1]=l*f+o*u+r*c-a*p,t[e+2]=r*f+o*p+a*u-l*c,t[e+3]=o*f-a*c-l*u-r*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const i=t._x,s=t._y,n=t._z,h=t._order,a=Math.cos,l=Math.sin,r=a(i/2),o=a(s/2),c=a(n/2),u=l(i/2),p=l(s/2),f=l(n/2);switch(h){case"XYZ":this._x=u*o*c+r*p*f,this._y=r*p*c-u*o*f,this._z=r*o*f+u*p*c,this._w=r*o*c-u*p*f;break;case"YXZ":this._x=u*o*c+r*p*f,this._y=r*p*c-u*o*f,this._z=r*o*f-u*p*c,this._w=r*o*c+u*p*f;break;case"ZXY":this._x=u*o*c-r*p*f,this._y=r*p*c+u*o*f,this._z=r*o*f+u*p*c,this._w=r*o*c-u*p*f;break;case"ZYX":this._x=u*o*c-r*p*f,this._y=r*p*c+u*o*f,this._z=r*o*f-u*p*c,this._w=r*o*c+u*p*f;break;case"YZX":this._x=u*o*c+r*p*f,this._y=r*p*c+u*o*f,this._z=r*o*f-u*p*c,this._w=r*o*c-u*p*f;break;case"XZY":this._x=u*o*c-r*p*f,this._y=r*p*c-u*o*f,this._z=r*o*f+u*p*c,this._w=r*o*c+u*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+h)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],n=e[8],h=e[1],a=e[5],l=e[9],r=e[2],o=e[6],c=e[10],u=i+a+c;if(u>0){const p=.5/Math.sqrt(u+1);this._w=.25/p,this._x=(o-l)*p,this._y=(n-r)*p,this._z=(h-s)*p}else if(i>a&&i>c){const p=2*Math.sqrt(1+i-a-c);this._w=(o-l)/p,this._x=.25*p,this._y=(s+h)/p,this._z=(n+r)/p}else if(a>c){const p=2*Math.sqrt(1+a-i-c);this._w=(n-r)/p,this._x=(s+h)/p,this._y=.25*p,this._z=(l+o)/p}else{const p=2*Math.sqrt(1+c-i-a);this._w=(h-s)/p,this._x=(n+r)/p,this._y=(l+o)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(mt(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,n=t._z,h=t._w,a=e._x,l=e._y,r=e._z,o=e._w;return this._x=i*o+h*a+s*r-n*l,this._y=s*o+h*l+n*a-i*r,this._z=n*o+h*r+i*l-s*a,this._w=h*o-i*a-s*l-n*r,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,s=this._y,n=this._z,h=this._w;let a=h*t._w+i*t._x+s*t._y+n*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=h,this._x=i,this._y=s,this._z=n,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-e;return this._w=p*h+e*this._w,this._x=p*i+e*this._x,this._y=p*s+e*this._y,this._z=p*n+e*this._z,this.normalize(),this}const r=Math.sqrt(l),o=Math.atan2(r,a),c=Math.sin((1-e)*o)/r,u=Math.sin(e*o)/r;return this._w=h*c+this._w*u,this._x=i*c+this._x*u,this._y=s*c+this._y*u,this._z=n*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(n),i*Math.cos(n),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class w{constructor(t=0,e=0,i=0){w.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(cs.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(cs.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*s,this.y=n[1]*e+n[4]*i+n[7]*s,this.z=n[2]*e+n[5]*i+n[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,n=t.elements,h=1/(n[3]*e+n[7]*i+n[11]*s+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*s+n[12])*h,this.y=(n[1]*e+n[5]*i+n[9]*s+n[13])*h,this.z=(n[2]*e+n[6]*i+n[10]*s+n[14])*h,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,n=t.x,h=t.y,a=t.z,l=t.w,r=2*(h*s-a*i),o=2*(a*e-n*s),c=2*(n*i-h*e);return this.x=e+l*r+h*c-a*o,this.y=i+l*o+a*r-n*c,this.z=s+l*c+n*o-h*r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*s,this.y=n[1]*e+n[5]*i+n[9]*s,this.z=n[2]*e+n[6]*i+n[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,n=t.z,h=e.x,a=e.y,l=e.z;return this.x=s*l-n*a,this.y=n*h-i*l,this.z=i*a-s*h,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return gi.copy(this).projectOnVector(t),this.sub(gi)}reflect(t){return this.sub(gi.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(mt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const gi=new w,cs=new Ee;class Ce{constructor(t=new w(1/0,1/0,1/0),e=new w(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(vt.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(vt.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=vt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(i!==void 0){const n=i.getAttribute("position");if(e===!0&&n!==void 0&&t.isInstancedMesh!==!0)for(let h=0,a=n.count;h<a;h++)t.isMesh===!0?t.getVertexPosition(h,vt):vt.fromBufferAttribute(n,h),vt.applyMatrix4(t.matrixWorld),this.expandByPoint(vt);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),Ie.copy(t.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Ie.copy(i.boundingBox)),Ie.applyMatrix4(t.matrixWorld),this.union(Ie)}const s=t.children;for(let n=0,h=s.length;n<h;n++)this.expandByObject(s[n],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,vt),vt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(we),Be.subVectors(this.max,we),ie.subVectors(t.a,we),se.subVectors(t.b,we),ne.subVectors(t.c,we),qt.subVectors(se,ie),jt.subVectors(ne,se),Gt.subVectors(ie,ne);let e=[0,-qt.z,qt.y,0,-jt.z,jt.y,0,-Gt.z,Gt.y,qt.z,0,-qt.x,jt.z,0,-jt.x,Gt.z,0,-Gt.x,-qt.y,qt.x,0,-jt.y,jt.x,0,-Gt.y,Gt.x,0];return!xi(e,ie,se,ne,Be)||(e=[1,0,0,0,1,0,0,0,1],!xi(e,ie,se,ne,Be))?!1:(Le.crossVectors(qt,jt),e=[Le.x,Le.y,Le.z],xi(e,ie,se,ne,Be))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,vt).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(vt).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(It[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),It[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),It[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),It[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),It[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),It[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),It[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),It[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(It),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const It=[new w,new w,new w,new w,new w,new w,new w,new w],vt=new w,Ie=new Ce,ie=new w,se=new w,ne=new w,qt=new w,jt=new w,Gt=new w,we=new w,Be=new w,Le=new w,Xt=new w;function xi(d,t,e,i,s){for(let n=0,h=d.length-3;n<=h;n+=3){Xt.fromArray(d,n);const a=s.x*Math.abs(Xt.x)+s.y*Math.abs(Xt.y)+s.z*Math.abs(Xt.z),l=t.dot(Xt),r=e.dot(Xt),o=i.dot(Xt);if(Math.max(-Math.max(l,r,o),Math.min(l,r,o))>a)return!1}return!0}const _n=new Ce,Me=new w,bi=new w;class hi{constructor(t=new w,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;e!==void 0?i.copy(e):_n.setFromPoints(t).getCenter(i);let s=0;for(let n=0,h=t.length;n<h;n++)s=Math.max(s,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Me.subVectors(t,this.center);const e=Me.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),s=(i-this.radius)*.5;this.center.addScaledVector(Me,s/i),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(bi.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Me.copy(t.center).add(bi)),this.expandByPoint(Me.copy(t.center).sub(bi))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Bt=new w,wi=new w,De=new w,Ut=new w,Mi=new w,Pe=new w,_i=new w;class qi{constructor(t=new w,e=new w(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Bt)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Bt.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Bt.copy(this.origin).addScaledVector(this.direction,e),Bt.distanceToSquared(t))}distanceSqToSegment(t,e,i,s){wi.copy(t).add(e).multiplyScalar(.5),De.copy(e).sub(t).normalize(),Ut.copy(this.origin).sub(wi);const n=t.distanceTo(e)*.5,h=-this.direction.dot(De),a=Ut.dot(this.direction),l=-Ut.dot(De),r=Ut.lengthSq(),o=Math.abs(1-h*h);let c,u,p,f;if(o>0)if(c=h*l-a,u=h*a-l,f=n*o,c>=0)if(u>=-f)if(u<=f){const y=1/o;c*=y,u*=y,p=c*(c+h*u+2*a)+u*(h*c+u+2*l)+r}else u=n,c=Math.max(0,-(h*u+a)),p=-c*c+u*(u+2*l)+r;else u=-n,c=Math.max(0,-(h*u+a)),p=-c*c+u*(u+2*l)+r;else u<=-f?(c=Math.max(0,-(-h*n+a)),u=c>0?-n:Math.min(Math.max(-n,-l),n),p=-c*c+u*(u+2*l)+r):u<=f?(c=0,u=Math.min(Math.max(-n,-l),n),p=u*(u+2*l)+r):(c=Math.max(0,-(h*n+a)),u=c>0?n:Math.min(Math.max(-n,-l),n),p=-c*c+u*(u+2*l)+r);else u=h>0?-n:n,c=Math.max(0,-(h*u+a)),p=-c*c+u*(u+2*l)+r;return i&&i.copy(this.origin).addScaledVector(this.direction,c),s&&s.copy(wi).addScaledVector(De,u),p}intersectSphere(t,e){Bt.subVectors(t.center,this.origin);const i=Bt.dot(this.direction),s=Bt.dot(Bt)-i*i,n=t.radius*t.radius;if(s>n)return null;const h=Math.sqrt(n-s),a=i-h,l=i+h;return l<0?null:a<0?this.at(l,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,s,n,h,a,l;const r=1/this.direction.x,o=1/this.direction.y,c=1/this.direction.z,u=this.origin;return r>=0?(i=(t.min.x-u.x)*r,s=(t.max.x-u.x)*r):(i=(t.max.x-u.x)*r,s=(t.min.x-u.x)*r),o>=0?(n=(t.min.y-u.y)*o,h=(t.max.y-u.y)*o):(n=(t.max.y-u.y)*o,h=(t.min.y-u.y)*o),i>h||n>s||((n>i||isNaN(i))&&(i=n),(h<s||isNaN(s))&&(s=h),c>=0?(a=(t.min.z-u.z)*c,l=(t.max.z-u.z)*c):(a=(t.max.z-u.z)*c,l=(t.min.z-u.z)*c),i>l||a>s)||((a>i||i!==i)&&(i=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(i>=0?i:s,e)}intersectsBox(t){return this.intersectBox(t,Bt)!==null}intersectTriangle(t,e,i,s,n){Mi.subVectors(e,t),Pe.subVectors(i,t),_i.crossVectors(Mi,Pe);let h=this.direction.dot(_i),a;if(h>0){if(s)return null;a=1}else if(h<0)a=-1,h=-h;else return null;Ut.subVectors(this.origin,t);const l=a*this.direction.dot(Pe.crossVectors(Ut,Pe));if(l<0)return null;const r=a*this.direction.dot(Mi.cross(Ut));if(r<0||l+r>h)return null;const o=-a*Ut.dot(_i);return o<0?null:this.at(o/h,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class xt{constructor(t,e,i,s,n,h,a,l,r,o,c,u,p,f,y,x){xt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,i,s,n,h,a,l,r,o,c,u,p,f,y,x)}set(t,e,i,s,n,h,a,l,r,o,c,u,p,f,y,x){const M=this.elements;return M[0]=t,M[4]=e,M[8]=i,M[12]=s,M[1]=n,M[5]=h,M[9]=a,M[13]=l,M[2]=r,M[6]=o,M[10]=c,M[14]=u,M[3]=p,M[7]=f,M[11]=y,M[15]=x,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new xt().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/re.setFromMatrixColumn(t,0).length(),n=1/re.setFromMatrixColumn(t,1).length(),h=1/re.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*h,e[9]=i[9]*h,e[10]=i[10]*h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,s=t.y,n=t.z,h=Math.cos(i),a=Math.sin(i),l=Math.cos(s),r=Math.sin(s),o=Math.cos(n),c=Math.sin(n);if(t.order==="XYZ"){const u=h*o,p=h*c,f=a*o,y=a*c;e[0]=l*o,e[4]=-l*c,e[8]=r,e[1]=p+f*r,e[5]=u-y*r,e[9]=-a*l,e[2]=y-u*r,e[6]=f+p*r,e[10]=h*l}else if(t.order==="YXZ"){const u=l*o,p=l*c,f=r*o,y=r*c;e[0]=u+y*a,e[4]=f*a-p,e[8]=h*r,e[1]=h*c,e[5]=h*o,e[9]=-a,e[2]=p*a-f,e[6]=y+u*a,e[10]=h*l}else if(t.order==="ZXY"){const u=l*o,p=l*c,f=r*o,y=r*c;e[0]=u-y*a,e[4]=-h*c,e[8]=f+p*a,e[1]=p+f*a,e[5]=h*o,e[9]=y-u*a,e[2]=-h*r,e[6]=a,e[10]=h*l}else if(t.order==="ZYX"){const u=h*o,p=h*c,f=a*o,y=a*c;e[0]=l*o,e[4]=f*r-p,e[8]=u*r+y,e[1]=l*c,e[5]=y*r+u,e[9]=p*r-f,e[2]=-r,e[6]=a*l,e[10]=h*l}else if(t.order==="YZX"){const u=h*l,p=h*r,f=a*l,y=a*r;e[0]=l*o,e[4]=y-u*c,e[8]=f*c+p,e[1]=c,e[5]=h*o,e[9]=-a*o,e[2]=-r*o,e[6]=p*c+f,e[10]=u-y*c}else if(t.order==="XZY"){const u=h*l,p=h*r,f=a*l,y=a*r;e[0]=l*o,e[4]=-c,e[8]=r*o,e[1]=u*c+y,e[5]=h*o,e[9]=p*c-f,e[2]=f*c-p,e[6]=a*o,e[10]=y*c+u}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Sn,t,vn)}lookAt(t,e,i){const s=this.elements;return yt.subVectors(t,e),yt.lengthSq()===0&&(yt.z=1),yt.normalize(),Vt.crossVectors(i,yt),Vt.lengthSq()===0&&(Math.abs(i.z)===1?yt.x+=1e-4:yt.z+=1e-4,yt.normalize(),Vt.crossVectors(i,yt)),Vt.normalize(),Ne.crossVectors(yt,Vt),s[0]=Vt.x,s[4]=Ne.x,s[8]=yt.x,s[1]=Vt.y,s[5]=Ne.y,s[9]=yt.y,s[2]=Vt.z,s[6]=Ne.z,s[10]=yt.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,n=this.elements,h=i[0],a=i[4],l=i[8],r=i[12],o=i[1],c=i[5],u=i[9],p=i[13],f=i[2],y=i[6],x=i[10],M=i[14],E=i[3],R=i[7],_=i[11],C=i[15],T=s[0],v=s[4],m=s[8],g=s[12],b=s[1],S=s[5],A=s[9],F=s[13],W=s[2],D=s[6],Z=s[10],k=s[14],H=s[3],I=s[7],P=s[11],B=s[15];return n[0]=h*T+a*b+l*W+r*H,n[4]=h*v+a*S+l*D+r*I,n[8]=h*m+a*A+l*Z+r*P,n[12]=h*g+a*F+l*k+r*B,n[1]=o*T+c*b+u*W+p*H,n[5]=o*v+c*S+u*D+p*I,n[9]=o*m+c*A+u*Z+p*P,n[13]=o*g+c*F+u*k+p*B,n[2]=f*T+y*b+x*W+M*H,n[6]=f*v+y*S+x*D+M*I,n[10]=f*m+y*A+x*Z+M*P,n[14]=f*g+y*F+x*k+M*B,n[3]=E*T+R*b+_*W+C*H,n[7]=E*v+R*S+_*D+C*I,n[11]=E*m+R*A+_*Z+C*P,n[15]=E*g+R*F+_*k+C*B,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],n=t[12],h=t[1],a=t[5],l=t[9],r=t[13],o=t[2],c=t[6],u=t[10],p=t[14],f=t[3],y=t[7],x=t[11],M=t[15];return f*(+n*l*c-s*r*c-n*a*u+i*r*u+s*a*p-i*l*p)+y*(+e*l*p-e*r*u+n*h*u-s*h*p+s*r*o-n*l*o)+x*(+e*r*c-e*a*p-n*h*c+i*h*p+n*a*o-i*r*o)+M*(-s*a*o-e*l*c+e*a*u+s*h*c-i*h*u+i*l*o)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],h=t[4],a=t[5],l=t[6],r=t[7],o=t[8],c=t[9],u=t[10],p=t[11],f=t[12],y=t[13],x=t[14],M=t[15],E=c*x*r-y*u*r+y*l*p-a*x*p-c*l*M+a*u*M,R=f*u*r-o*x*r-f*l*p+h*x*p+o*l*M-h*u*M,_=o*y*r-f*c*r+f*a*p-h*y*p-o*a*M+h*c*M,C=f*c*l-o*y*l-f*a*u+h*y*u+o*a*x-h*c*x,T=e*E+i*R+s*_+n*C;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const v=1/T;return t[0]=E*v,t[1]=(y*u*n-c*x*n-y*s*p+i*x*p+c*s*M-i*u*M)*v,t[2]=(a*x*n-y*l*n+y*s*r-i*x*r-a*s*M+i*l*M)*v,t[3]=(c*l*n-a*u*n-c*s*r+i*u*r+a*s*p-i*l*p)*v,t[4]=R*v,t[5]=(o*x*n-f*u*n+f*s*p-e*x*p-o*s*M+e*u*M)*v,t[6]=(f*l*n-h*x*n-f*s*r+e*x*r+h*s*M-e*l*M)*v,t[7]=(h*u*n-o*l*n+o*s*r-e*u*r-h*s*p+e*l*p)*v,t[8]=_*v,t[9]=(f*c*n-o*y*n-f*i*p+e*y*p+o*i*M-e*c*M)*v,t[10]=(h*y*n-f*a*n+f*i*r-e*y*r-h*i*M+e*a*M)*v,t[11]=(o*a*n-h*c*n-o*i*r+e*c*r+h*i*p-e*a*p)*v,t[12]=C*v,t[13]=(o*y*s-f*c*s+f*i*u-e*y*u-o*i*x+e*c*x)*v,t[14]=(f*a*s-h*y*s-f*i*l+e*y*l+h*i*x-e*a*x)*v,t[15]=(h*c*s-o*a*s+o*i*l-e*c*l-h*i*u+e*a*u)*v,this}scale(t){const e=this.elements,i=t.x,s=t.y,n=t.z;return e[0]*=i,e[4]*=s,e[8]*=n,e[1]*=i,e[5]*=s,e[9]*=n,e[2]*=i,e[6]*=s,e[10]*=n,e[3]*=i,e[7]*=s,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),n=1-i,h=t.x,a=t.y,l=t.z,r=n*h,o=n*a;return this.set(r*h+i,r*a-s*l,r*l+s*a,0,r*a+s*l,o*a+i,o*l-s*h,0,r*l-s*a,o*l+s*h,n*l*l+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,n,h){return this.set(1,i,n,0,t,1,h,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,n=e._x,h=e._y,a=e._z,l=e._w,r=n+n,o=h+h,c=a+a,u=n*r,p=n*o,f=n*c,y=h*o,x=h*c,M=a*c,E=l*r,R=l*o,_=l*c,C=i.x,T=i.y,v=i.z;return s[0]=(1-(y+M))*C,s[1]=(p+_)*C,s[2]=(f-R)*C,s[3]=0,s[4]=(p-_)*T,s[5]=(1-(u+M))*T,s[6]=(x+E)*T,s[7]=0,s[8]=(f+R)*v,s[9]=(x-E)*v,s[10]=(1-(u+y))*v,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let n=re.set(s[0],s[1],s[2]).length();const h=re.set(s[4],s[5],s[6]).length(),a=re.set(s[8],s[9],s[10]).length();this.determinant()<0&&(n=-n),t.x=s[12],t.y=s[13],t.z=s[14],At.copy(this);const r=1/n,o=1/h,c=1/a;return At.elements[0]*=r,At.elements[1]*=r,At.elements[2]*=r,At.elements[4]*=o,At.elements[5]*=o,At.elements[6]*=o,At.elements[8]*=c,At.elements[9]*=c,At.elements[10]*=c,e.setFromRotationMatrix(At),i.x=n,i.y=h,i.z=a,this}makePerspective(t,e,i,s,n,h,a=Re){const l=this.elements,r=2*n/(e-t),o=2*n/(i-s),c=(e+t)/(e-t),u=(i+s)/(i-s);let p,f;if(a===Re)p=-(h+n)/(h-n),f=-2*h*n/(h-n);else if(a===rs)p=-h/(h-n),f=-h*n/(h-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=r,l[4]=0,l[8]=c,l[12]=0,l[1]=0,l[5]=o,l[9]=u,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,i,s,n,h,a=Re){const l=this.elements,r=1/(e-t),o=1/(i-s),c=1/(h-n),u=(e+t)*r,p=(i+s)*o;let f,y;if(a===Re)f=(h+n)*c,y=-2*c;else if(a===rs)f=n*c,y=-1*c;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*r,l[4]=0,l[8]=0,l[12]=-u,l[1]=0,l[5]=2*o,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=y,l[14]=-f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<16;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const re=new w,At=new xt,Sn=new w(0,0,0),vn=new w(1,1,1),Vt=new w,Ne=new w,yt=new w,ds=new xt,us=new Ee;class li{constructor(t=0,e=0,i=0,s=li.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const s=t.elements,n=s[0],h=s[4],a=s[8],l=s[1],r=s[5],o=s[9],c=s[2],u=s[6],p=s[10];switch(e){case"XYZ":this._y=Math.asin(mt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-o,p),this._z=Math.atan2(-h,n)):(this._x=Math.atan2(u,r),this._z=0);break;case"YXZ":this._x=Math.asin(-mt(o,-1,1)),Math.abs(o)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,r)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(mt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-h,r)):(this._y=0,this._z=Math.atan2(l,n));break;case"ZYX":this._y=Math.asin(-mt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,p),this._z=Math.atan2(l,n)):(this._x=0,this._z=Math.atan2(-h,r));break;case"YZX":this._z=Math.asin(mt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-o,r),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-mt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,r),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-o,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return ds.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ds,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return us.setFromEuler(this),this.setFromQuaternion(us,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}li.DEFAULT_ORDER="XYZ";class An{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Tn=0;const ps=new w,ae=new Ee,Lt=new xt,Oe=new w,_e=new w,zn=new w,En=new Ee,fs=new w(1,0,0),ms=new w(0,1,0),ys=new w(0,0,1),Cn={type:"added"},Fn={type:"removed"};class _t extends oi{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Tn++}),this.uuid=ze(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=_t.DEFAULT_UP.clone();const t=new w,e=new li,i=new Ee,s=new w(1,1,1);function n(){i.setFromEuler(e,!1)}function h(){e.setFromQuaternion(i,void 0,!1)}e._onChange(n),i._onChange(h),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new xt},normalMatrix:{value:new $t}}),this.matrix=new xt,this.matrixWorld=new xt,this.matrixAutoUpdate=_t.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=_t.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new An,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return ae.setFromAxisAngle(t,e),this.quaternion.multiply(ae),this}rotateOnWorldAxis(t,e){return ae.setFromAxisAngle(t,e),this.quaternion.premultiply(ae),this}rotateX(t){return this.rotateOnAxis(fs,t)}rotateY(t){return this.rotateOnAxis(ms,t)}rotateZ(t){return this.rotateOnAxis(ys,t)}translateOnAxis(t,e){return ps.copy(t).applyQuaternion(this.quaternion),this.position.add(ps.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(fs,t)}translateY(t){return this.translateOnAxis(ms,t)}translateZ(t){return this.translateOnAxis(ys,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Lt.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?Oe.copy(t):Oe.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),_e.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Lt.lookAt(_e,Oe,this.up):Lt.lookAt(Oe,_e,this.up),this.quaternion.setFromRotationMatrix(Lt),s&&(Lt.extractRotation(s.matrixWorld),ae.setFromRotationMatrix(Lt),this.quaternion.premultiply(ae.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Cn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Fn)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Lt.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Lt.multiply(t.parent.matrixWorld)),t.applyMatrix4(Lt),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const h=this.children[i].getObjectByProperty(t,e);if(h!==void 0)return h}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const s=this.children;for(let n=0,h=s.length;n<h;n++)s[n].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_e,t,zn),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_e,En,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++){const n=e[i];(n.matrixWorldAutoUpdate===!0||t===!0)&&n.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const s=this.children;for(let n=0,h=s.length;n<h;n++){const a=s[n];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(t),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function n(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=n(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let r=0,o=l.length;r<o;r++){const c=l[r];n(t.shapes,c)}else n(t.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,r=this.material.length;l<r;l++)a.push(n(t.materials,this.material[l]));s.material=a}else s.material=n(t.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];s.animations.push(n(t.animations,l))}}if(e){const a=h(t.geometries),l=h(t.materials),r=h(t.textures),o=h(t.images),c=h(t.shapes),u=h(t.skeletons),p=h(t.animations),f=h(t.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),r.length>0&&(i.textures=r),o.length>0&&(i.images=o),c.length>0&&(i.shapes=c),u.length>0&&(i.skeletons=u),p.length>0&&(i.animations=p),f.length>0&&(i.nodes=f)}return i.object=s,i;function h(a){const l=[];for(const r in a){const o=a[r];delete o.metadata,l.push(o)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const s=t.children[i];this.add(s.clone())}return this}}_t.DEFAULT_UP=new w(0,1,0);_t.DEFAULT_MATRIX_AUTO_UPDATE=!0;_t.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Tt=new w,Dt=new w,Si=new w,Pt=new w,oe=new w,he=new w,gs=new w,vi=new w,Ai=new w,Ti=new w;class Rt{constructor(t=new w,e=new w,i=new w){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,s){s.subVectors(i,e),Tt.subVectors(t,e),s.cross(Tt);const n=s.lengthSq();return n>0?s.multiplyScalar(1/Math.sqrt(n)):s.set(0,0,0)}static getBarycoord(t,e,i,s,n){Tt.subVectors(s,e),Dt.subVectors(i,e),Si.subVectors(t,e);const h=Tt.dot(Tt),a=Tt.dot(Dt),l=Tt.dot(Si),r=Dt.dot(Dt),o=Dt.dot(Si),c=h*r-a*a;if(c===0)return n.set(0,0,0),null;const u=1/c,p=(r*l-a*o)*u,f=(h*o-a*l)*u;return n.set(1-p-f,f,p)}static containsPoint(t,e,i,s){return this.getBarycoord(t,e,i,s,Pt)===null?!1:Pt.x>=0&&Pt.y>=0&&Pt.x+Pt.y<=1}static getInterpolation(t,e,i,s,n,h,a,l){return this.getBarycoord(t,e,i,s,Pt)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(n,Pt.x),l.addScaledVector(h,Pt.y),l.addScaledVector(a,Pt.z),l)}static isFrontFacing(t,e,i,s){return Tt.subVectors(i,e),Dt.subVectors(t,e),Tt.cross(Dt).dot(s)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,s){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,i,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Tt.subVectors(this.c,this.b),Dt.subVectors(this.a,this.b),Tt.cross(Dt).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Rt.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Rt.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,i,s,n){return Rt.getInterpolation(t,this.a,this.b,this.c,e,i,s,n)}containsPoint(t){return Rt.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Rt.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,s=this.b,n=this.c;let h,a;oe.subVectors(s,i),he.subVectors(n,i),vi.subVectors(t,i);const l=oe.dot(vi),r=he.dot(vi);if(l<=0&&r<=0)return e.copy(i);Ai.subVectors(t,s);const o=oe.dot(Ai),c=he.dot(Ai);if(o>=0&&c<=o)return e.copy(s);const u=l*c-o*r;if(u<=0&&l>=0&&o<=0)return h=l/(l-o),e.copy(i).addScaledVector(oe,h);Ti.subVectors(t,n);const p=oe.dot(Ti),f=he.dot(Ti);if(f>=0&&p<=f)return e.copy(n);const y=p*r-l*f;if(y<=0&&r>=0&&f<=0)return a=r/(r-f),e.copy(i).addScaledVector(he,a);const x=o*f-p*c;if(x<=0&&c-o>=0&&p-f>=0)return gs.subVectors(n,s),a=(c-o)/(c-o+(p-f)),e.copy(s).addScaledVector(gs,a);const M=1/(x+y+u);return h=y*M,a=u*M,e.copy(i).addScaledVector(oe,h).addScaledVector(he,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Gs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Wt={h:0,s:0,l:0},qe={h:0,s:0,l:0};function zi(d,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?d+(t-d)*6*e:e<1/2?t:e<2/3?d+(t-d)*6*(2/3-e):d}class bt{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(e===void 0&&i===void 0){const s=t;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=zt){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,St.toWorkingColorSpace(this,e),this}setRGB(t,e,i,s=St.workingColorSpace){return this.r=t,this.g=e,this.b=i,St.toWorkingColorSpace(this,s),this}setHSL(t,e,i,s=St.workingColorSpace){if(t=mn(t,1),e=mt(e,0,1),i=mt(i,0,1),e===0)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,h=2*i-n;this.r=zi(h,n,t+1/3),this.g=zi(h,n,t),this.b=zi(h,n,t-1/3)}return St.toWorkingColorSpace(this,s),this}setStyle(t,e=zt){function i(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const h=s[1],a=s[2];switch(h){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=s[1],h=n.length;if(h===3)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(h===6)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=zt){const i=Gs[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=fe(t.r),this.g=fe(t.g),this.b=fe(t.b),this}copyLinearToSRGB(t){return this.r=mi(t.r),this.g=mi(t.g),this.b=mi(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=zt){return St.fromWorkingColorSpace(dt.copy(this),t),Math.round(mt(dt.r*255,0,255))*65536+Math.round(mt(dt.g*255,0,255))*256+Math.round(mt(dt.b*255,0,255))}getHexString(t=zt){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=St.workingColorSpace){St.fromWorkingColorSpace(dt.copy(this),e);const i=dt.r,s=dt.g,n=dt.b,h=Math.max(i,s,n),a=Math.min(i,s,n);let l,r;const o=(a+h)/2;if(a===h)l=0,r=0;else{const c=h-a;switch(r=o<=.5?c/(h+a):c/(2-h-a),h){case i:l=(s-n)/c+(s<n?6:0);break;case s:l=(n-i)/c+2;break;case n:l=(i-s)/c+4;break}l/=6}return t.h=l,t.s=r,t.l=o,t}getRGB(t,e=St.workingColorSpace){return St.fromWorkingColorSpace(dt.copy(this),e),t.r=dt.r,t.g=dt.g,t.b=dt.b,t}getStyle(t=zt){St.fromWorkingColorSpace(dt.copy(this),t);const e=dt.r,i=dt.g,s=dt.b;return t!==zt?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(t,e,i){return this.getHSL(Wt),this.setHSL(Wt.h+t,Wt.s+e,Wt.l+i)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Wt),t.getHSL(qe);const i=pi(Wt.h,qe.h,e),s=pi(Wt.s,qe.s,e),n=pi(Wt.l,qe.l,e);return this.setHSL(i,s,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,s=this.b,n=t.elements;return this.r=n[0]*e+n[3]*i+n[6]*s,this.g=n[1]*e+n[4]*i+n[7]*s,this.b=n[2]*e+n[5]*i+n[8]*s,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const dt=new bt;bt.NAMES=Gs;let Rn=0;class me extends oi{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Rn++}),this.uuid=ze(),this.name="",this.type="Material",this.blending=Hi,this.side=Li,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Gi,this.blendDst=Xi,this.blendEquation=$i,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new bt(0,0,0),this.blendAlpha=0,this.depthFunc=Yi,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=ss,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=te,this.stencilZFail=te,this.stencilZPass=te,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const i=t[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Hi&&(i.blending=this.blending),this.side!==Li&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==Gi&&(i.blendSrc=this.blendSrc),this.blendDst!==Xi&&(i.blendDst=this.blendDst),this.blendEquation!==$i&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Yi&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==ss&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==te&&(i.stencilFail=this.stencilFail),this.stencilZFail!==te&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==te&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(n){const h=[];for(const a in n){const l=n[a];delete l.metadata,h.push(l)}return h}if(e){const n=s(t.textures),h=s(t.images);n.length>0&&(i.textures=n),h.length>0&&(i.images=h)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(e!==null){const s=e.length;i=new Array(s);for(let n=0;n!==s;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class kn extends me{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new bt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ws,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const it=new w,je=new ut;class Jt{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=ns,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=hn,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return si("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let s=0,n=this.itemSize;s<n;s++)this.array[t+s]=e.array[i+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)je.fromBufferAttribute(this,e),je.applyMatrix3(t),this.setXY(e,je.x,je.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)it.fromBufferAttribute(this,e),it.applyMatrix3(t),this.setXYZ(e,it.x,it.y,it.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)it.fromBufferAttribute(this,e),it.applyMatrix4(t),this.setXYZ(e,it.x,it.y,it.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)it.fromBufferAttribute(this,e),it.applyNormalMatrix(t),this.setXYZ(e,it.x,it.y,it.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)it.fromBufferAttribute(this,e),it.transformDirection(t),this.setXYZ(e,it.x,it.y,it.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=be(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=ft(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=be(e,this.array)),e}setX(t,e){return this.normalized&&(e=ft(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=be(e,this.array)),e}setY(t,e){return this.normalized&&(e=ft(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=be(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ft(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=be(e,this.array)),e}setW(t,e){return this.normalized&&(e=ft(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=ft(e,this.array),i=ft(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,s){return t*=this.itemSize,this.normalized&&(e=ft(e,this.array),i=ft(i,this.array),s=ft(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this}setXYZW(t,e,i,s,n){return t*=this.itemSize,this.normalized&&(e=ft(e,this.array),i=ft(i,this.array),s=ft(s,this.array),n=ft(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==ns&&(t.usage=this.usage),t}}class In extends Jt{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class Bn extends Jt{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Ot extends Jt{constructor(t,e,i){super(new Float32Array(t),e,i)}}let Ln=0;const wt=new xt,Ei=new _t,le=new w,gt=new Ce,Se=new Ce,rt=new w;class Zt extends oi{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ln++}),this.uuid=ze(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(yn(t)?Bn:In)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const n=new $t().getNormalMatrix(t);i.applyNormalMatrix(n),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return wt.makeRotationFromQuaternion(t),this.applyMatrix4(wt),this}rotateX(t){return wt.makeRotationX(t),this.applyMatrix4(wt),this}rotateY(t){return wt.makeRotationY(t),this.applyMatrix4(wt),this}rotateZ(t){return wt.makeRotationZ(t),this.applyMatrix4(wt),this}translate(t,e,i){return wt.makeTranslation(t,e,i),this.applyMatrix4(wt),this}scale(t,e,i){return wt.makeScale(t,e,i),this.applyMatrix4(wt),this}lookAt(t){return Ei.lookAt(t),Ei.updateMatrix(),this.applyMatrix4(Ei.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(le).negate(),this.translate(le.x,le.y,le.z),this}setFromPoints(t){const e=[];for(let i=0,s=t.length;i<s;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Ot(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ce);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new w(-1/0,-1/0,-1/0),new w(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,s=e.length;i<s;i++){const n=e[i];gt.setFromBufferAttribute(n),this.morphTargetsRelative?(rt.addVectors(this.boundingBox.min,gt.min),this.boundingBox.expandByPoint(rt),rt.addVectors(this.boundingBox.max,gt.max),this.boundingBox.expandByPoint(rt)):(this.boundingBox.expandByPoint(gt.min),this.boundingBox.expandByPoint(gt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new hi);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new w,1/0);return}if(t){const i=this.boundingSphere.center;if(gt.setFromBufferAttribute(t),e)for(let n=0,h=e.length;n<h;n++){const a=e[n];Se.setFromBufferAttribute(a),this.morphTargetsRelative?(rt.addVectors(gt.min,Se.min),gt.expandByPoint(rt),rt.addVectors(gt.max,Se.max),gt.expandByPoint(rt)):(gt.expandByPoint(Se.min),gt.expandByPoint(Se.max))}gt.getCenter(i);let s=0;for(let n=0,h=t.count;n<h;n++)rt.fromBufferAttribute(t,n),s=Math.max(s,i.distanceToSquared(rt));if(e)for(let n=0,h=e.length;n<h;n++){const a=e[n],l=this.morphTargetsRelative;for(let r=0,o=a.count;r<o;r++)rt.fromBufferAttribute(a,r),l&&(le.fromBufferAttribute(t,r),rt.add(le)),s=Math.max(s,i.distanceToSquared(rt))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.array,s=e.position.array,n=e.normal.array,h=e.uv.array,a=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Jt(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,r=[],o=[];for(let b=0;b<a;b++)r[b]=new w,o[b]=new w;const c=new w,u=new w,p=new w,f=new ut,y=new ut,x=new ut,M=new w,E=new w;function R(b,S,A){c.fromArray(s,b*3),u.fromArray(s,S*3),p.fromArray(s,A*3),f.fromArray(h,b*2),y.fromArray(h,S*2),x.fromArray(h,A*2),u.sub(c),p.sub(c),y.sub(f),x.sub(f);const F=1/(y.x*x.y-x.x*y.y);isFinite(F)&&(M.copy(u).multiplyScalar(x.y).addScaledVector(p,-y.y).multiplyScalar(F),E.copy(p).multiplyScalar(y.x).addScaledVector(u,-x.x).multiplyScalar(F),r[b].add(M),r[S].add(M),r[A].add(M),o[b].add(E),o[S].add(E),o[A].add(E))}let _=this.groups;_.length===0&&(_=[{start:0,count:i.length}]);for(let b=0,S=_.length;b<S;++b){const A=_[b],F=A.start,W=A.count;for(let D=F,Z=F+W;D<Z;D+=3)R(i[D+0],i[D+1],i[D+2])}const C=new w,T=new w,v=new w,m=new w;function g(b){v.fromArray(n,b*3),m.copy(v);const S=r[b];C.copy(S),C.sub(v.multiplyScalar(v.dot(S))).normalize(),T.crossVectors(m,S);const F=T.dot(o[b])<0?-1:1;l[b*4]=C.x,l[b*4+1]=C.y,l[b*4+2]=C.z,l[b*4+3]=F}for(let b=0,S=_.length;b<S;++b){const A=_[b],F=A.start,W=A.count;for(let D=F,Z=F+W;D<Z;D+=3)g(i[D+0]),g(i[D+1]),g(i[D+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Jt(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let u=0,p=i.count;u<p;u++)i.setXYZ(u,0,0,0);const s=new w,n=new w,h=new w,a=new w,l=new w,r=new w,o=new w,c=new w;if(t)for(let u=0,p=t.count;u<p;u+=3){const f=t.getX(u+0),y=t.getX(u+1),x=t.getX(u+2);s.fromBufferAttribute(e,f),n.fromBufferAttribute(e,y),h.fromBufferAttribute(e,x),o.subVectors(h,n),c.subVectors(s,n),o.cross(c),a.fromBufferAttribute(i,f),l.fromBufferAttribute(i,y),r.fromBufferAttribute(i,x),a.add(o),l.add(o),r.add(o),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(y,l.x,l.y,l.z),i.setXYZ(x,r.x,r.y,r.z)}else for(let u=0,p=e.count;u<p;u+=3)s.fromBufferAttribute(e,u+0),n.fromBufferAttribute(e,u+1),h.fromBufferAttribute(e,u+2),o.subVectors(h,n),c.subVectors(s,n),o.cross(c),i.setXYZ(u+0,o.x,o.y,o.z),i.setXYZ(u+1,o.x,o.y,o.z),i.setXYZ(u+2,o.x,o.y,o.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)rt.fromBufferAttribute(t,e),rt.normalize(),t.setXYZ(e,rt.x,rt.y,rt.z)}toNonIndexed(){function t(a,l){const r=a.array,o=a.itemSize,c=a.normalized,u=new r.constructor(l.length*o);let p=0,f=0;for(let y=0,x=l.length;y<x;y++){a.isInterleavedBufferAttribute?p=l[y]*a.data.stride+a.offset:p=l[y]*o;for(let M=0;M<o;M++)u[f++]=r[p++]}return new Jt(u,o,c)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Zt,i=this.index.array,s=this.attributes;for(const a in s){const l=s[a],r=t(l,i);e.setAttribute(a,r)}const n=this.morphAttributes;for(const a in n){const l=[],r=n[a];for(let o=0,c=r.length;o<c;o++){const u=r[o],p=t(u,i);l.push(p)}e.morphAttributes[a]=l}e.morphTargetsRelative=this.morphTargetsRelative;const h=this.groups;for(let a=0,l=h.length;a<l;a++){const r=h[a];e.addGroup(r.start,r.count,r.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const r in l)l[r]!==void 0&&(t[r]=l[r]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const l in i){const r=i[l];t.data.attributes[l]=r.toJSON(t.data)}const s={};let n=!1;for(const l in this.morphAttributes){const r=this.morphAttributes[l],o=[];for(let c=0,u=r.length;c<u;c++){const p=r[c];o.push(p.toJSON(t.data))}o.length>0&&(s[l]=o,n=!0)}n&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const h=this.groups;h.length>0&&(t.data.groups=JSON.parse(JSON.stringify(h)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone(e));const s=t.attributes;for(const r in s){const o=s[r];this.setAttribute(r,o.clone(e))}const n=t.morphAttributes;for(const r in n){const o=[],c=n[r];for(let u=0,p=c.length;u<p;u++)o.push(c[u].clone(e));this.morphAttributes[r]=o}this.morphTargetsRelative=t.morphTargetsRelative;const h=t.groups;for(let r=0,o=h.length;r<o;r++){const c=h[r];this.addGroup(c.start,c.count,c.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const xs=new xt,Yt=new qi,Ue=new hi,bs=new w,ce=new w,de=new w,ue=new w,Ci=new w,Ve=new w,We=new ut,He=new ut,$e=new ut,ws=new w,Ms=new w,_s=new w,Ge=new w,Xe=new w;class Ss extends _t{constructor(t=new Zt,e=new kn){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,h=s.length;n<h;n++){const a=s[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}getVertexPosition(t,e){const i=this.geometry,s=i.attributes.position,n=i.morphAttributes.position,h=i.morphTargetsRelative;e.fromBufferAttribute(s,t);const a=this.morphTargetInfluences;if(n&&a){Ve.set(0,0,0);for(let l=0,r=n.length;l<r;l++){const o=a[l],c=n[l];o!==0&&(Ci.fromBufferAttribute(c,t),h?Ve.addScaledVector(Ci,o):Ve.addScaledVector(Ci.sub(e),o))}e.add(Ve)}return e}raycast(t,e){const i=this.geometry,s=this.material,n=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Ue.copy(i.boundingSphere),Ue.applyMatrix4(n),Yt.copy(t.ray).recast(t.near),!(Ue.containsPoint(Yt.origin)===!1&&(Yt.intersectSphere(Ue,bs)===null||Yt.origin.distanceToSquared(bs)>(t.far-t.near)**2))&&(xs.copy(n).invert(),Yt.copy(t.ray).applyMatrix4(xs),!(i.boundingBox!==null&&Yt.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(t,e,Yt)))}_computeIntersections(t,e,i){let s;const n=this.geometry,h=this.material,a=n.index,l=n.attributes.position,r=n.attributes.uv,o=n.attributes.uv1,c=n.attributes.normal,u=n.groups,p=n.drawRange;if(a!==null)if(Array.isArray(h))for(let f=0,y=u.length;f<y;f++){const x=u[f],M=h[x.materialIndex],E=Math.max(x.start,p.start),R=Math.min(a.count,Math.min(x.start+x.count,p.start+p.count));for(let _=E,C=R;_<C;_+=3){const T=a.getX(_),v=a.getX(_+1),m=a.getX(_+2);s=Ye(this,M,t,i,r,o,c,T,v,m),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=x.materialIndex,e.push(s))}}else{const f=Math.max(0,p.start),y=Math.min(a.count,p.start+p.count);for(let x=f,M=y;x<M;x+=3){const E=a.getX(x),R=a.getX(x+1),_=a.getX(x+2);s=Ye(this,h,t,i,r,o,c,E,R,_),s&&(s.faceIndex=Math.floor(x/3),e.push(s))}}else if(l!==void 0)if(Array.isArray(h))for(let f=0,y=u.length;f<y;f++){const x=u[f],M=h[x.materialIndex],E=Math.max(x.start,p.start),R=Math.min(l.count,Math.min(x.start+x.count,p.start+p.count));for(let _=E,C=R;_<C;_+=3){const T=_,v=_+1,m=_+2;s=Ye(this,M,t,i,r,o,c,T,v,m),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=x.materialIndex,e.push(s))}}else{const f=Math.max(0,p.start),y=Math.min(l.count,p.start+p.count);for(let x=f,M=y;x<M;x+=3){const E=x,R=x+1,_=x+2;s=Ye(this,h,t,i,r,o,c,E,R,_),s&&(s.faceIndex=Math.floor(x/3),e.push(s))}}}}function Dn(d,t,e,i,s,n,h,a){let l;if(t.side===sn?l=i.intersectTriangle(h,n,s,!0,a):l=i.intersectTriangle(s,n,h,t.side===Li,a),l===null)return null;Xe.copy(a),Xe.applyMatrix4(d.matrixWorld);const r=e.ray.origin.distanceTo(Xe);return r<e.near||r>e.far?null:{distance:r,point:Xe.clone(),object:d}}function Ye(d,t,e,i,s,n,h,a,l,r){d.getVertexPosition(a,ce),d.getVertexPosition(l,de),d.getVertexPosition(r,ue);const o=Dn(d,t,e,i,ce,de,ue,Ge);if(o){s&&(We.fromBufferAttribute(s,a),He.fromBufferAttribute(s,l),$e.fromBufferAttribute(s,r),o.uv=Rt.getInterpolation(Ge,ce,de,ue,We,He,$e,new ut)),n&&(We.fromBufferAttribute(n,a),He.fromBufferAttribute(n,l),$e.fromBufferAttribute(n,r),o.uv1=Rt.getInterpolation(Ge,ce,de,ue,We,He,$e,new ut),o.uv2=o.uv1),h&&(ws.fromBufferAttribute(h,a),Ms.fromBufferAttribute(h,l),_s.fromBufferAttribute(h,r),o.normal=Rt.getInterpolation(Ge,ce,de,ue,ws,Ms,_s,new w),o.normal.dot(i.direction)>0&&o.normal.multiplyScalar(-1));const c={a,b:l,c:r,normal:new w,materialIndex:0};Rt.getNormal(ce,de,ue,c.normal),o.face=c}return o}class Pn extends Ht{constructor(t,e,i,s,n,h,a,l,r,o){if(o=o!==void 0?o:di,o!==di&&o!==Qi)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&o===di&&(i=on),i===void 0&&o===Qi&&(i=ln),super(null,s,n,h,a,l,o,i,r),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:Ki,this.minFilter=l!==void 0?l:Ki,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}const Nn=new Pn(1,1);Nn.compareFunction=fn;class On extends _t{constructor(){super(),this.isGroup=!0,this.type="Group"}}class ni extends me{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new bt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const vs=new w,As=new w,Ts=new xt,Fi=new qi,Je=new hi;class qn extends _t{constructor(t=new Zt,e=new ni){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,i=[0];for(let s=1,n=e.count;s<n;s++)vs.fromBufferAttribute(e,s-1),As.fromBufferAttribute(e,s),i[s]=i[s-1],i[s]+=vs.distanceTo(As);t.setAttribute("lineDistance",new Ot(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,s=this.matrixWorld,n=t.params.Line.threshold,h=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Je.copy(i.boundingSphere),Je.applyMatrix4(s),Je.radius+=n,t.ray.intersectsSphere(Je)===!1)return;Ts.copy(s).invert(),Fi.copy(t.ray).applyMatrix4(Ts);const a=n/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,r=new w,o=new w,c=new w,u=new w,p=this.isLineSegments?2:1,f=i.index,x=i.attributes.position;if(f!==null){const M=Math.max(0,h.start),E=Math.min(f.count,h.start+h.count);for(let R=M,_=E-1;R<_;R+=p){const C=f.getX(R),T=f.getX(R+1);if(r.fromBufferAttribute(x,C),o.fromBufferAttribute(x,T),Fi.distanceSqToSegment(r,o,u,c)>l)continue;u.applyMatrix4(this.matrixWorld);const m=t.ray.origin.distanceTo(u);m<t.near||m>t.far||e.push({distance:m,point:c.clone().applyMatrix4(this.matrixWorld),index:R,face:null,faceIndex:null,object:this})}}else{const M=Math.max(0,h.start),E=Math.min(x.count,h.start+h.count);for(let R=M,_=E-1;R<_;R+=p){if(r.fromBufferAttribute(x,R),o.fromBufferAttribute(x,R+1),Fi.distanceSqToSegment(r,o,u,c)>l)continue;u.applyMatrix4(this.matrixWorld);const T=t.ray.origin.distanceTo(u);T<t.near||T>t.far||e.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:R,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,h=s.length;n<h;n++){const a=s[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}}const zs=new w,Es=new w;class Cs extends qn{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,i=[];for(let s=0,n=e.count;s<n;s+=2)zs.fromBufferAttribute(e,s),Es.fromBufferAttribute(e,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+zs.distanceTo(Es);t.setAttribute("lineDistance",new Ot(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Ae extends me{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new bt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Fs=new xt,Pi=new qi,Ze=new hi,Ke=new w;class Ri extends _t{constructor(t=new Zt,e=new Ae){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,s=this.matrixWorld,n=t.params.Points.threshold,h=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Ze.copy(i.boundingSphere),Ze.applyMatrix4(s),Ze.radius+=n,t.ray.intersectsSphere(Ze)===!1)return;Fs.copy(s).invert(),Pi.copy(t.ray).applyMatrix4(Fs);const a=n/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,r=i.index,c=i.attributes.position;if(r!==null){const u=Math.max(0,h.start),p=Math.min(r.count,h.start+h.count);for(let f=u,y=p;f<y;f++){const x=r.getX(f);Ke.fromBufferAttribute(c,x),Rs(Ke,x,l,s,t,e,this)}}else{const u=Math.max(0,h.start),p=Math.min(c.count,h.start+h.count);for(let f=u,y=p;f<y;f++)Ke.fromBufferAttribute(c,f),Rs(Ke,f,l,s,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,h=s.length;n<h;n++){const a=s[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}}function Rs(d,t,e,i,s,n,h){const a=Pi.distanceSqToPoint(d);if(a<e){const l=new w;Pi.closestPointToPoint(d,l),l.applyMatrix4(i);const r=s.ray.origin.distanceTo(l);if(r<s.near||r>s.far)return;n.push({distance:r,distanceToRay:Math.sqrt(a),point:l,index:t,face:null,object:h})}}class jn extends me{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new bt(16777215),this.specular=new bt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=un,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ws,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}const ks={enabled:!1,files:{},add:function(d,t){this.enabled!==!1&&(this.files[d]=t)},get:function(d){if(this.enabled!==!1)return this.files[d]},remove:function(d){delete this.files[d]},clear:function(){this.files={}}};class Un{constructor(t,e,i){const s=this;let n=!1,h=0,a=0,l;const r=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(o){a++,n===!1&&s.onStart!==void 0&&s.onStart(o,h,a),n=!0},this.itemEnd=function(o){h++,s.onProgress!==void 0&&s.onProgress(o,h,a),h===a&&(n=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(o){s.onError!==void 0&&s.onError(o)},this.resolveURL=function(o){return l?l(o):o},this.setURLModifier=function(o){return l=o,this},this.addHandler=function(o,c){return r.push(o,c),this},this.removeHandler=function(o){const c=r.indexOf(o);return c!==-1&&r.splice(c,2),this},this.getHandler=function(o){for(let c=0,u=r.length;c<u;c+=2){const p=r[c],f=r[c+1];if(p.global&&(p.lastIndex=0),p.test(o))return f}return null}}}const Vn=new Un;class ji{constructor(t){this.manager=t!==void 0?t:Vn,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise(function(s,n){i.load(t,s,e,n)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}ji.DEFAULT_MATERIAL_NAME="__DEFAULT";const Nt={};class Wn extends Error{constructor(t,e){super(t),this.response=e}}class Hn extends ji{constructor(t){super(t)}load(t,e,i,s){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const n=ks.get(t);if(n!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(n),this.manager.itemEnd(t)},0),n;if(Nt[t]!==void 0){Nt[t].push({onLoad:e,onProgress:i,onError:s});return}Nt[t]=[],Nt[t].push({onLoad:e,onProgress:i,onError:s});const h=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(h).then(r=>{if(r.status===200||r.status===0){if(r.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||r.body===void 0||r.body.getReader===void 0)return r;const o=Nt[t],c=r.body.getReader(),u=r.headers.get("Content-Length")||r.headers.get("X-File-Size"),p=u?parseInt(u):0,f=p!==0;let y=0;const x=new ReadableStream({start(M){E();function E(){c.read().then(({done:R,value:_})=>{if(R)M.close();else{y+=_.byteLength;const C=new ProgressEvent("progress",{lengthComputable:f,loaded:y,total:p});for(let T=0,v=o.length;T<v;T++){const m=o[T];m.onProgress&&m.onProgress(C)}M.enqueue(_),E()}})}}});return new Response(x)}else throw new Wn(`fetch for "${r.url}" responded with ${r.status}: ${r.statusText}`,r)}).then(r=>{switch(l){case"arraybuffer":return r.arrayBuffer();case"blob":return r.blob();case"document":return r.text().then(o=>new DOMParser().parseFromString(o,a));case"json":return r.json();default:if(a===void 0)return r.text();{const c=/charset="?([^;"\s]*)"?/i.exec(a),u=c&&c[1]?c[1].toLowerCase():void 0,p=new TextDecoder(u);return r.arrayBuffer().then(f=>p.decode(f))}}}).then(r=>{ks.add(t,r);const o=Nt[t];delete Nt[t];for(let c=0,u=o.length;c<u;c++){const p=o[c];p.onLoad&&p.onLoad(r)}}).catch(r=>{const o=Nt[t];if(o===void 0)throw this.manager.itemError(t),r;delete Nt[t];for(let c=0,u=o.length;c<u;c++){const p=o[c];p.onError&&p.onError(r)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Vs}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Vs);class $n{constructor(t){this.nodes=t.nodes,this.edges=t.edges,this.nodeMap=new Map(this.nodes.map(e=>[e.id,e])),this.edgeMap=new Map(this.edges.map(e=>[e.id,e]))}getNodePosition(t){const e=this.nodeMap.get(t);if(!e)return new w;const i=Array.isArray(e.coordinate)?e.coordinate:e.coordinate&&typeof e.coordinate=="object"?[e.coordinate.x,e.coordinate.y,e.coordinate.z]:[0,0,0];return new w(...i)}edgeLength(t){const e=this.getNodePosition(t.from),i=this.getNodePosition(t.to);return e.distanceTo(i)}}class Gn{constructor(t,e){this.registry=t||[],this.readings=e.map(i=>({...i,time:typeof i.time=="string"?new Date(i.time).getTime():i.time})).filter(i=>Number.isFinite(i.time)&&Number.isFinite(i.value)),this.grouped=this.groupBySensor()}groupBySensor(){const t=new Map;for(const e of this.readings)t.has(e.sensorID)||t.set(e.sensorID,[]),t.get(e.sensorID).push(e);for(const e of t.values())e.sort((i,s)=>i.time-s.time);return t}getSensor(t){return this.registry.find(e=>e.sensorID===t)}getSeries(t,e=-1/0,i=1/0){return(this.grouped.get(t)||[]).filter(n=>n.time>=e&&n.time<=i)}getSnapshot(t,e=10){const i=e*60*1e3,s=new Map,n=this.registry.length?this.registry.map(h=>h.sensorID):Array.from(this.grouped.keys());for(const h of n){const a=this.grouped.get(h)||[];if(!a.length)continue;let l=null,r=null;for(const u of a)if(u.time<=t&&(l=u),u.time>=t){r=u;break}let o=null;if(l&&r)if(l.time===r.time)o=l.value;else{const u=(t-l.time)/(r.time-l.time||1);o=l.value+(r.value-l.value)*u}else l?o=l.value:r&&(o=r.value);const c=l&&r?t:(l==null?void 0:l.time)??(r==null?void 0:r.time)??1/0;o!=null&&Math.abs(c-t)<=i&&s.set(h,o)}return s}listSensors(){return this.registry}}class Xn{constructor(t){this.source=t.source||{type:"file",path:""},this.contractId=t.contractId,this.roleMapping=t.roleMapping||{},this.bindings=t.bindings||{},this.facets=t.facets||[],this.raw=null,this.objText=null,this.bindingResolver=null}async load(t){var e;if(this.source.type==="inline"){const i=this.source.data;return typeof i=="string"&&this.contractId==="RoadwayGeometry"?(this.objText=i,this.raw=this.parseObjNames(i)):this.raw=i,this}if(this.contractId==="RoadwayGeometry"&&this.source.type==="auto"){const i=this.resolveBinding("topo_ref_id");return(e=i==null?void 0:i.edges)!=null&&e.length&&(this.raw=i.edges.map(s=>({name:s.id,topo:s.id}))),this}if(this.source.type==="file"){const i=this.source.path;if(i.endsWith(".csv"))this.raw=await t.loadCsv(i);else if(i.endsWith(".obj"))try{const n=await(await fetch(i)).text();this.objText=n,this.raw=this.parseObjNames(n)}catch(s){console.error("Failed to parse OBJ file:",s),this.raw=[]}else try{this.raw=await t.loadJson(i)}catch{this.raw=[]}}return this}parseObjNames(t){const e=new Set;return t.split(`
`).forEach(i=>{const s=i.trim();if(s.startsWith("o ")||s.startsWith("g ")){const n=s.substring(2).trim();n&&e.add(n)}}),e.size===0&&e.add("Model_Root"),Array.from(e).map(i=>({name:i}))}getContract(){return pe.get(this.contractId)}getByPath(t,e,i=void 0){if(!t||!e)return i;const s=Array.isArray(e)?e:`${e}`.split(".");let n=t;for(const h of s){if(n==null)return i;Array.isArray(n)&&!Number.isNaN(Number(h))?n=n[Number(h)]:n=n[h]}return n===void 0?i:n}validateRoles(){const t=this.getContract();if(!t)return[];const e=[];for(const i of t.required_roles||[])this.roleMapping[i.roleKey]||e.push(i.roleKey);return e}resolveBinding(t){var i;if(!this.bindingResolver)return null;const e=(i=this.bindings)==null?void 0:i[t];return e?this.bindingResolver(e):null}resolveFacet(t){const e=this.facets.find(s=>s.id===t||`facet-${s.id}`===t);if(!e)return null;const i=this.getContract();if(!i)return null;switch(i.id){case"RoadwayTopology":return this.resolveRoadwayTopology(e);case"SensorStationRegistry":return this.resolveSensorRegistry(e);case"SensorReadingTimeSeries":return this.resolveSensorReadings(e);case"RoadwayGeometry":return this.resolveRoadwayGeometry();default:return this.raw}}resolveRoadwayTopology(){var a,l;const t=this.roleMapping,i=(((a=this.raw)==null?void 0:a.nodes)||(Array.isArray(this.raw)?this.raw:[])).map(r=>{const o=this.getByPath(r,t.node_pos||"coordinate")||this.getByPath(r,"position")||this.getByPath(r,"coordinate"),c=Array.isArray(o)?o:o?[o.x,o.y,o.z]:[0,0,0];return{id:this.getByPath(r,t.node_id||"id"),name:this.getByPath(r,t.node_name||"name"),coordinate:c}}),s=new Map(i.map(r=>[r.id,r])),h=(((l=this.raw)==null?void 0:l.edges)||[]).map(r=>({id:this.getByPath(r,t.edge_id||"id"),name:r.name||this.getByPath(r,t.edge_id||"id"),from:this.getByPath(r,t.from_node||"from")??this.getByPath(r,"from")??this.getByPath(r,"source"),to:this.getByPath(r,t.to_node||"to")??this.getByPath(r,"to")??this.getByPath(r,"target"),path:this.getByPath(r,t.edge_path||"path")}));return new $n({nodes:i,edges:h,nodeMap:s})}resolveSensorRegistry(){const t=this.roleMapping;return(Array.isArray(this.raw)?this.raw:[]).map(i=>({sensorID:this.getByPath(i,t.sensor_id||"sensorID"),x:Number(this.getByPath(i,t.x||"x")),y:Number(this.getByPath(i,t.y||"y")),z:Number(this.getByPath(i,t.z||"z")),roadwayID:this.getByPath(i,t.roadway_node_ref||"roadwayID")}))}resolveSensorReadings(t){const e=this.resolveBinding("sensor_id"),i=this.roleMapping,n=(Array.isArray(this.raw)?this.raw:[]).map(h=>({sensorID:this.getByPath(h,i.sensor_id||"sensorID"),time:(()=>{const a=this.getByPath(h,i.timestamp||"time");return typeof a=="number"?a:Date.parse(a)})(),value:(()=>{const a=this.getByPath(h,i.value||"value");return typeof a=="number"?a:Number(a)})()}));return new Gn((e==null?void 0:e.raw)||e||[],n)}resolveRoadwayGeometry(){const t=this.roleMapping;return(Array.isArray(this.raw)?this.raw:[]).map(i=>({mesh_part_id:i[t.mesh_part_id||"name"],topo_ref_id:i[t.topo_ref_id||"topo"]||i[t.mesh_part_id||"name"]}))}}const Ni={RoadwayTopology:[{id:"graph",label:"Graph",facetType:"Graph",outputType:"RoadwayGraph",preset:{mode:"full"}}],RoadwayGeometry:[{id:"meshParts",label:"Mesh Parts",facetType:"MeshParts",outputType:"RoadwayMeshParts"}],SensorStationRegistry:[{id:"registry",label:"Registry",facetType:"Registry",outputType:"SensorRegistry"},{id:"points",label:"Points3D",facetType:"Points",outputType:"SensorPoints3D"}],SensorReadingTimeSeries:[{id:"series",label:"Series",facetType:"Series",outputType:"SensorDataset"},{id:"snapshot",label:"Snapshot",facetType:"Snapshot",outputType:"SensorDataset"},{id:"value",label:"Value(latest)",facetType:"Value",outputType:"SensorDataset"}],ModelLibrary:[{id:"models",label:"Models",facetType:"ModelSet",outputType:"ModelLibrary"}]};function Is(d){return(d.params.facets||[]).map(e=>({id:`facet-${e.id}`,name:`${e.label||e.id}`,direction:"out",type:e.outputType||`facet:${e.facetType}`,facetType:e.facetType,outputType:e.outputType||"raw"}))}const Yn=[{typeId:"DataNode",label:"Data Resource",kind:"data",buildPorts(d){return Is(d)},defaultParams:{source:{type:"file",path:"/data/roadwayTopo.json"},contractId:"RoadwayTopology",roleMapping:{},bindings:{},facets:Ni.RoadwayTopology},createRuntime(){return{async execute(d,t,e,i){const s=new Xn(t.params);return s.bindings=t.bindings||t.params.bindings||{},s.bindingResolver=i,await s.load(d),s},updateFacets(d){var e;const t=pe.get(d.params.contractId);t&&(d.label=t.name||d.label,d.params.facets=(e=d.params.facets)!=null&&e.length?d.params.facets:Ni[d.params.contractId]||[],d.ports=Is(d))}}}}];function Qe(d,t={}){var i;const e=pe.get(d);return{source:{type:"file",path:t.path||""},contractId:d,roleMapping:((i=e==null?void 0:e.required_roles)==null?void 0:i.reduce((s,n)=>({...s,[n.roleKey]:n.defaultField||""}),{}))||{},bindings:{},facets:Ni[d]||[]}}const Te={rainbow:[{stop:0,color:"#2c7bb6"},{stop:.25,color:"#00a6ca"},{stop:.5,color:"#00ccbc"},{stop:.75,color:"#90eb9d"},{stop:1,color:"#f9d057"}],viridis:[{stop:0,color:"#440154"},{stop:.2,color:"#3b528b"},{stop:.4,color:"#21918c"},{stop:.6,color:"#5ec962"},{stop:1,color:"#fde725"}],heat:[{stop:0,color:"#000004"},{stop:.25,color:"#51127c"},{stop:.5,color:"#b73779"},{stop:.75,color:"#fc8961"},{stop:1,color:"#f9e721"}]},ri={...Te};function Jn(d,t,e){const i=Bs(d),s=Bs(t),n={r:i.r+(s.r-i.r)*e,g:i.g+(s.g-i.g)*e,b:i.b+(s.b-i.b)*e};return`rgb(${n.r.toFixed(0)}, ${n.g.toFixed(0)}, ${n.b.toFixed(0)})`}function Bs(d){const t=d.replace("#",""),e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:e&255}}function Zn(d,t){const e=ri[d]||ri.rainbow,i=Math.max(0,Math.min(1,t));let s=e[0],n=e[e.length-1];for(let a=0;a<e.length-1;a++)if(i>=e[a].stop&&i<=e[a+1].stop){s=e[a],n=e[a+1];break}const h=(i-s.stop)/(n.stop-s.stop||1);return Jn(s.color,n.color,h)}function Kn(d,t){if(!Array.isArray(t)||!t.length)return;const e=d||"custom";ri[e]=t.map((i,s)=>({stop:typeof i.stop=="number"?i.stop:s/Math.max(t.length-1,1),color:i.color||"#ffffff"})).sort((i,s)=>i.stop-s.stop)}function Qn(d){!d||!Te[d]||(ri[d]=Te[d].map(t=>({...t})))}function tr(d){return(Te[d]||Te.rainbow).map(t=>({...t}))}function er(d,t="#3a4a7a"){var s;const e=d.geometry;if(!e||!((s=e.attributes)!=null&&s.position))return;const i=e.attributes.position.count;if(!e.attributes.color||e.attributes.color.count!==i){const n=new bt(t),h=new Float32Array(i*3);for(let a=0;a<i;a++)h[a*3]=n.r,h[a*3+1]=n.g,h[a*3+2]=n.b;e.setAttribute("color",new Jt(h,3))}d.material&&(d.material.vertexColors=!0,d.material.needsUpdate=!0)}function ir(d){if(!(d!=null&&d.nodes)||!(d!=null&&d.edges))return[];const t=d.nodeMap||new Map(d.nodes.map(e=>[e.id,e]));return d.edges.map((e,i)=>{var l,r;const s=((l=t.get(e.from))==null?void 0:l.coordinate)||[0,0,0],n=((r=t.get(e.to))==null?void 0:r.coordinate)||[0,0,0],h=Array.isArray(e.path)&&e.path.length?e.path.map(o=>({x:o.x??o[0]??0,y:o.y??o[1]??0,z:o.z??o[2]??0})):[],a=h.length>=2?h:[{x:s[0],y:s[1],z:s[2]},{x:n[0],y:n[1],z:n[2]}];return{id:e.id,idx:i,j1:e.from,j2:e.to,verts:a}})}function Xs(d){const t=new Map;for(const e of d)t.has(e.j1)||t.set(e.j1,[]),t.has(e.j2)||t.set(e.j2,[]),t.get(e.j1).push(e),t.get(e.j2).push(e);return t}function Ls(d,t,e,i){const s=[],n=t.get(d.j1)??i,h=t.get(d.j2)??i;s.push({t:0,v:n});const a=d._totalLen??sr(d);return e.filter(r=>r.parentType==="Connection"&&(r.parentId===d.id||r.parentIndex===d.idx)).forEach(r=>{let o=Number.isFinite(r.ratio)?r.ratio:Ys(r,d);o=Math.max(0,Math.min(1,o)),s.push({t:o,v:r.value})}),s.push({t:1,v:h}),s.sort((r,o)=>r.t-o.t),{controls:s,totalLen:a||1}}function sr(d){if(!(d!=null&&d.verts)||d.verts.length<2)return 1;let t=0;for(let e=0;e<d.verts.length-1;e++){const i=d.verts[e],s=d.verts[e+1];t+=new w(s.x-i.x,s.y-i.y,s.z-i.z).length()}return d._totalLen=t||1,d._totalLen}function nr(d,t,e,i=0,s=5){const n=new Map(d.map(a=>[a.id,null])),h=Xs(t);e.forEach(a=>{a.parentType==="Node"&&a.parentId&&n.set(a.parentId,a.value)}),t.forEach(a=>{const l=e.filter(o=>o.parentType==="Connection"&&(o.parentId===a.id||o.parentIndex===a.idx));if(!l.length)return;const r=l.reduce((o,c)=>o+c.value,0)/l.length;n.get(a.j1)===null&&n.set(a.j1,r),n.get(a.j2)===null&&n.set(a.j2,r)});for(let a=0;a<s;a++)d.forEach(l=>{if(n.get(l.id)!==null)return;let r=0,o=0;(h.get(l.id)||[]).forEach(u=>{const p=e.filter(x=>x.parentType==="Connection"&&(x.parentId===u.id||x.parentIndex===u.idx));if(p.length>0){const x=p.reduce((M,E)=>M+E.value,0)/p.length;r+=x,o++;return}const f=u.j1===l.id?u.j2:u.j1,y=n.get(f);y!=null&&(r+=y,o++)}),o>0&&n.set(l.id,r/o)});return d.forEach(a=>{n.get(a.id)===null&&n.set(a.id,i)}),{nodeVals:n,nodeConnMap:h}}function Ys(d,t){var a;if(!((a=t==null?void 0:t.verts)!=null&&a.length)||t.verts.length===1)return .5;let e=0;const i=[];for(let l=0;l<t.verts.length-1;l++){const r=t.verts[l],o=t.verts[l+1],c=new w(o.x-r.x,o.y-r.y,o.z-r.z).length();i.push(c),e+=c}if(e<1e-6)return .5;const s=new w(d.x,d.y,d.z);let n=0,h=0;for(let l=0;l<t.verts.length-1;l++){const r=t.verts[l],o=t.verts[l+1],c=new w(r.x,r.y,r.z),u=new w(o.x,o.y,o.z),p=new w().subVectors(u,c),f=Math.max(p.lengthSq(),1e-6);let y=new w().subVectors(s,c).dot(p)/f;y=Math.max(0,Math.min(1,y));const x=y*i[l];if(h=(n+x)/e,y>0&&y<1)break;n+=i[l]}return h}function rr(d,t,e){return i=>{const s=(i-t)/(e-t||1);return Zn(d,s)}}function ar(d,t,e,i,s){const{min:n,max:h,map:a="rainbow"}=s||{},l=n??0,r=h??l+1;if(!d)return;const o=new Map(t.map(f=>[f.id,f])),c=new Map,u=rr(a,l,r),p=Xs(t);d.traverse(f=>{var E,R,_,C,T,v,m,g,b,S,A,F,W;const y=(E=f.userData)==null?void 0:E.heatmap;if(!f.isMesh||!y)return;er(f,(_=(R=f.material)==null?void 0:R.color)==null?void 0:_.getStyle()),f.updateMatrixWorld();const x=f.geometry.attributes.color,M=f.geometry.attributes.position;if(!(!x||!M)){if(y.type==="Connection"){const D=o.get((C=y.data)==null?void 0:C.id)||o.get((T=y.data)==null?void 0:T.topoId)||y.data;if(!D)return;const Z=D.id||((v=y.data)==null?void 0:v.id);c.has(Z)||c.set(Z,Ls(D,e,i,l));const{controls:k,totalLen:H}=c.get(Z),I=new w(((g=(m=D.verts)==null?void 0:m[0])==null?void 0:g.x)||0,((S=(b=D.verts)==null?void 0:b[0])==null?void 0:S.y)||0,((F=(A=D.verts)==null?void 0:A[0])==null?void 0:F.z)||0),P=((W=D.verts)==null?void 0:W[D.verts.length-1])||{x:0,y:0,z:0},B=new w(P.x,P.y,P.z),N=new w().subVectors(B,I),z=Math.max(N.lengthSq(),1e-6),K=new w;for(let V=0;V<x.count;V++){const G=K.set(M.getX(V),M.getY(V),M.getZ(V)).applyMatrix4(f.matrixWorld);let tt=new w().subVectors(G,I).dot(N)/z;tt=Math.max(0,Math.min(1,tt));let O=k[0].v;for(let j=0;j<k.length-1;j++)if(tt>=k[j].t&&tt<=k[j+1].t){const L=k[j+1].t-k[j].t,$=Math.max(L*H,1e-6),et=L===0?0:(tt-k[j].t)/L,J=(k[j+1].v-k[j].v)/$;O=k[j].v+et*$*J;break}const q=new bt(u(O));x.setXYZ(V,q.r,q.g,q.b)}}else if(y.type==="Node"){const D=y.data,Z=new w(D.x,D.y,D.z),k=(p.get(D.id)||[]).map(P=>{const B=P.id,N=c.get(B)||Ls(P,e,i,l);c.set(B,N);const{controls:z,totalLen:K}=N;if(z.length<2)return null;const V=P.j1===D.id,G=V?[z[0],z[1]]:[z[z.length-2],z[z.length-1]],tt=Math.max(G[1].t-G[0].t,1e-6),O=Math.max(tt*K,1e-6),q=(G[1].v-G[0].v)/O,j=G[0].v,L=V?P.verts[0]:P.verts[P.verts.length-1],$=V?P.verts[1]||P.verts[0]:P.verts[P.verts.length-2]||P.verts[0],et=new w(L.x,L.y,L.z),J=new w($.x,$.y,$.z);return{dir:new w().subVectors(J,et).normalize(),slope:q,startVal:j}}).filter(Boolean),H=new w,I=new w;for(let P=0;P<x.count;P++){const B=H.set(M.getX(P),M.getY(P),M.getZ(P)).applyMatrix4(f.matrixWorld);I.subVectors(B,Z);const N=I.length();let z=l;if(N>.001&&k.length>0){const V=I.clone().normalize();let G=-1,tt=0,O=l;k.forEach(q=>{const j=V.dot(q.dir);j>G&&(G=j,tt=q.slope,O=q.startVal)}),z=O,G>0&&(z+=N*G*tt)}else k.length&&(z=k[0].startVal??l);const K=new bt(u(z));x.setXYZ(P,K.r,K.g,K.b)}}x.needsUpdate=!0}})}function or(d,t,e){const i=((d==null?void 0:d.nodes)||[]).map(a=>{var u,p,f;const l=Array.isArray(a.coordinate)?a.coordinate:[(u=a.coordinate)==null?void 0:u.x,(p=a.coordinate)==null?void 0:p.y,(f=a.coordinate)==null?void 0:f.z],[r=0,o=0,c=0]=l||[];return{id:a.id,x:r,y:o,z:c,coordinate:[r,o,c]}}),s=ir(d),n=[],h=new Set(s.map(a=>a.id));return(t||[]).forEach((a,l)=>{const r=e==null?void 0:e.get(a.sensorID);if(r==null)return;const o=a.roadwayID||a.nodeId||a.node_id||a.edgeId||a.edge_id||a.connectionId,c={x:Number(a.x),y:Number(a.y),z:Number(a.z)},u=Number.isFinite(Number(a.ratio))?Number(a.ratio):Number.isFinite(Number(a.t))?Number(a.t):null;o&&h.has(o)?n.push({parentType:"Connection",parentId:o,parentIndex:s.findIndex(p=>p.id===o),value:r,...c,ratio:u??Ys(c,s.find(p=>p.id===o))}):n.push({parentType:"Node",parentId:o,parentIndex:l,value:r,...c,ratio:u??.5})}),{nodes:i,connections:s,sensors:n}}class hr{constructor(t){this.sceneManager=t}pickById(t){const e=this.sceneManager.getSensorObject(t);return e&&this.sceneManager.highlightSensor(e),e}}class lr{constructor(t){this.sceneManager=t}focusOn(t){this.sceneManager.focusOn(t)}}class cr{constructor(t){this.dataset=t}run(t,e){const[i,s]=e||[-1/0,1/0];return this.dataset.getSeries(t,i,s)}}class dr{constructor(t){this.dataset=t}run(t,e){return this.dataset.getSnapshot(t,e)}}class ur{constructor(t){this.sceneManager=t,this.colormap="rainbow",this.min=10,this.max=40,this.customStops=null}setRange(t,e){this.min=t,this.max=e}setMap(t){this.colormap=t,this.customStops=null,Qn(t)}setCustomForCurrent(t){t&&(this.customStops=t,Kn(this.colormap,t))}apply(t,e,i){const s=t||[];ar(this.sceneManager.scene,s,e||new Map,i,{min:this.min,max:this.max,map:this.colormap})}}const pr=[{typeId:"SensorDetailFunction",label:"Sensor Detail",kind:"function",ports:[{id:"roadwayMesh",name:"roadway mesh",direction:"in",type:"RoadwayMeshParts"},{id:"sensorRegistry",name:"sensor registry",direction:"in",type:"SensorRegistry"},{id:"tempReadings",name:"readings",direction:"in",type:"SensorDataset"}],createRuntime(){return{attach(d,t,e,i){var h;if(!i||!((h=i.readings)!=null&&h.length))return;const s={pick:new hr(d),focus:new lr(d),series:new cr(i)},n=a=>{const l=s.pick.pickById(a);l&&s.focus.focusOn(l);const r=s.series.run(a);t.updateSeries(a,r)};e.onSelect=n,d.onSensorPick=n}}}},{typeId:"RoadwayTempSnapshotFunction",label:"Roadway Temp Snapshot",kind:"function",ports:[{id:"roadwayTopo",name:"topology",direction:"in",type:"RoadwayGraph"},{id:"roadwayMesh",name:"mesh",direction:"in",type:"RoadwayMeshParts"},{id:"sensorRegistry",name:"sensor registry",direction:"in",type:"SensorRegistry"},{id:"tempReadings",name:"readings",direction:"in",type:"SensorDataset"}],createRuntime(){return{attach(d,t,e,i,s){if(!e||!i||!s)return;const n={snapshot:new dr(e),color:new ur(d)};return{applySnapshot:a=>{const l=n.snapshot.run(a,20),{nodes:r,connections:o,sensors:c}=or(i,s,l),{nodeVals:u}=nr(r,o,c,n.color.min);n.color.apply(o,u,c),t.update(n.color.colormap,n.color.min,n.color.max)},operators:n}}}}}];class fr{constructor(){this.defs=new Map}register(t){this.defs.set(t.typeId,t)}get(t){return this.defs.get(t)}list(){return Array.from(this.defs.values())}}let ti;const mr=new Uint8Array(16);function yr(){if(!ti&&(ti=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ti))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ti(mr)}const ot=[];for(let d=0;d<256;++d)ot.push((d+256).toString(16).slice(1));function gr(d,t=0){return ot[d[t+0]]+ot[d[t+1]]+ot[d[t+2]]+ot[d[t+3]]+"-"+ot[d[t+4]]+ot[d[t+5]]+"-"+ot[d[t+6]]+ot[d[t+7]]+"-"+ot[d[t+8]]+ot[d[t+9]]+"-"+ot[d[t+10]]+ot[d[t+11]]+ot[d[t+12]]+ot[d[t+13]]+ot[d[t+14]]+ot[d[t+15]]}const xr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ds={randomUUID:xr};function Ps(d,t,e){if(Ds.randomUUID&&!d)return Ds.randomUUID();d=d||{};const i=d.random||(d.rng||yr)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,gr(i)}class br{constructor(t){this.definitionRegistry=t,this.nodes=[],this.edges=[],this.view={panX:0,panY:0,zoom:1}}createNode(t,e={x:0,y:0}){var n;const i=this.definitionRegistry.get(t);if(!i)throw new Error(`Unknown node type ${t}`);const s={id:Ps(),typeId:t,kind:i.kind,label:i.label,position:e,params:i.defaultParams?{...i.defaultParams}:{},roleMapping:i.defaultRoleMapping?{...i.defaultRoleMapping}:{},bindings:i.defaultBindings?{...i.defaultBindings}:{},ports:i.buildPorts?i.buildPorts({typeId:t,params:i.defaultParams||{}}):((n=i.ports)==null?void 0:n.map(h=>({...h})))||[],runtime:i.createRuntime()};return s.runtime.updateFacets&&s.runtime.updateFacets(s),this.nodes.push(s),s}connect(t,e){const i=this.nodes.find(a=>a.id===t.nodeId),s=this.nodes.find(a=>a.id===e.nodeId);if(!i||!s)return!1;const n=i.ports.find(a=>a.id===t.portId),h=s.ports.find(a=>a.id===e.portId);return!n||!h||n.direction!=="out"||h.direction!=="in"||n.type!==h.type?!1:(this.edges=this.edges.filter(a=>!(a.to.nodeId===e.nodeId&&a.to.portId===e.portId)),this.edges.push({id:Ps(),from:t,to:e}),!0)}removeNode(t){this.nodes=this.nodes.filter(e=>e.id!==t),this.edges=this.edges.filter(e=>e.from.nodeId!==t&&e.to.nodeId!==t)}removeEdge(t){this.edges=this.edges.filter(e=>e.id!==t)}serialize(){return JSON.stringify({nodes:this.nodes.map(t=>({id:t.id,typeId:t.typeId,kind:t.kind,label:t.label,position:t.position,params:t.params,roleMapping:t.roleMapping,bindings:t.bindings,ports:t.ports})),edges:this.edges,view:this.view},null,2)}load(t){this.nodes=[],this.edges=[];const e=typeof t=="string"?JSON.parse(t):t;this.view=e.view||{panX:0,panY:0,zoom:1};for(const i of e.nodes){const s=this.definitionRegistry.get(i.typeId);if(!s)continue;const n={id:i.id,typeId:i.typeId,kind:s.kind,label:i.label||s.label,position:i.position,params:i.params||{},roleMapping:i.roleMapping||{},bindings:i.bindings||{},ports:i.ports||(s.buildPorts?s.buildPorts(i):s.ports.map(h=>({...h}))),runtime:s.createRuntime()};n.runtime.updateFacets&&n.runtime.updateFacets(n),this.nodes.push(n)}this.edges=e.edges||[]}}class wr{constructor(t,e){this.container=t,this.graph=e,this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.classList.add("node-svg"),this.container.appendChild(this.svg),this.nodeLayer=document.createElement("div"),this.nodeLayer.className="node-layer",this.container.appendChild(this.nodeLayer),this.portPositions=new Map,this.draggingNode=null,this.draggingOffset={x:0,y:0},this.panOrigin=null,this.pendingLink=null,this.selectedNodeId=null,this.onSelect=null,this.onDelete=null,this.draggingPointerTarget=null,this.spacePanning=!1,this.registerEvents(),window.addEventListener("resize",()=>this.render()),window.addEventListener("keydown",i=>{var s,n;["INPUT","TEXTAREA","SELECT"].includes(i.target.tagName)||(i.code==="Space"&&(this.spacePanning=!0),i.key==="Escape"&&(this.pendingLink=null,this.clearCompatible(),this.renderLinks()),this.selectedNodeId&&(i.key==="Delete"||i.key==="Backspace")&&(this.graph.removeNode(this.selectedNodeId),this.selectedNodeId=null,(s=this.onSelect)==null||s.call(this,null),this.render(),(n=this.onDelete)==null||n.call(this)))}),window.addEventListener("keyup",i=>{i.code==="Space"&&(this.spacePanning=!1)})}worldToScreen(t){return{x:t.x*this.graph.view.zoom+this.graph.view.panX,y:t.y*this.graph.view.zoom+this.graph.view.panY}}screenToWorld(t){return{x:(t.x-this.graph.view.panX)/this.graph.view.zoom,y:(t.y-this.graph.view.panY)/this.graph.view.zoom}}registerEvents(){this.container.addEventListener("wheel",e=>{e.preventDefault();const i=e.deltaY>0?.9:1.1;this.graph.view.zoom=Math.max(.5,Math.min(2.5,this.graph.view.zoom*i)),this.render()});const t=e=>{this.container.setPointerCapture(e.pointerId),this.panOrigin={x:e.clientX,y:e.clientY,panX:this.graph.view.panX,panY:this.graph.view.panY}};["pointerdown"].forEach(e=>{this.container.addEventListener(e,i=>{const s=i.target===this.container||i.target===this.nodeLayer||i.target===this.svg;(i.button===1||i.button===2||i.altKey||this.spacePanning||s)&&t(i)})}),this.container.addEventListener("pointermove",e=>{if(this.panOrigin){const i=e.clientX-this.panOrigin.x,s=e.clientY-this.panOrigin.y;this.graph.view.panX=this.panOrigin.panX+i,this.graph.view.panY=this.panOrigin.panY+s,this.render()}if(this.draggingNode){const i=this.screenToWorld({x:e.clientX-this.container.getBoundingClientRect().left,y:e.clientY-this.container.getBoundingClientRect().top});this.draggingNode.position.x=i.x-this.draggingOffset.x,this.draggingNode.position.y=i.y-this.draggingOffset.y,this.render()}this.pendingLink&&this.renderLinks(this.pendingLink,{x:e.clientX-this.container.getBoundingClientRect().left,y:e.clientY-this.container.getBoundingClientRect().top})}),this.container.addEventListener("pointerup",e=>{var i,s,n;this.panOrigin&&this.container.releasePointerCapture(e.pointerId),this.draggingPointerTarget&&((s=(i=this.draggingPointerTarget).hasPointerCapture)!=null&&s.call(i,e.pointerId))&&this.draggingPointerTarget.releasePointerCapture(e.pointerId),(n=this.pendingLink)!=null&&n.detachEdgeId&&this.graph.removeEdge(this.pendingLink.detachEdgeId),this.panOrigin=null,this.draggingNode=null,this.draggingPointerTarget=null,this.pendingLink=null,this.clearCompatible(),this.render()})}render(){this.nodeLayer.innerHTML="",this.portPositions.clear();for(const t of this.graph.nodes){const e=document.createElement("div");e.className=`node kind-${t.kind}`,t.id===this.selectedNodeId&&e.classList.add("selected");const i=this.worldToScreen(t.position);e.style.transform=`translate(${i.x}px, ${i.y}px) scale(${this.graph.view.zoom})`,e.dataset.id=t.id;const s=document.createElement("div");s.className="node-header",s.textContent=t.label,s.addEventListener("pointerdown",o=>{o.stopPropagation(),e.setPointerCapture(o.pointerId),this.draggingPointerTarget=e;const c=this.screenToWorld({x:o.clientX-this.container.getBoundingClientRect().left,y:o.clientY-this.container.getBoundingClientRect().top});this.draggingNode=t,this.draggingOffset={x:c.x-t.position.x,y:c.y-t.position.y},this.selectedNodeId=t.id,this.onSelect&&this.onSelect(t)}),e.appendChild(s);const n=document.createElement("div");n.className="node-body",n.addEventListener("pointerdown",o=>{var c;o.stopPropagation(),this.selectedNodeId=t.id,(c=this.onSelect)==null||c.call(this,t)});const h=document.createElement("div");h.className="ports";const a=t.ports.filter(o=>o.direction==="in"),l=t.ports.filter(o=>o.direction==="out"),r=(o,c)=>{const u=document.createElement("div");u.className=`port ${o.direction}`,u.dataset.portId=o.id,u.dataset.type=o.type,u.title=`${o.name} : ${o.type}`,u.innerHTML=`<span class="dot"></span><span class="label">${o.name}</span><span class="type">${o.type}</span>`,u.addEventListener("pointerdown",p=>{if(p.stopPropagation(),o.direction==="out"){this.pendingLink={fromNode:t,fromPort:o},this.highlightCompatible(o.type);return}if(o.direction==="in"){const f=this.graph.edges.find(y=>y.to.nodeId===t.id&&y.to.portId===o.id);if(f){const y=this.graph.nodes.find(M=>M.id===f.from.nodeId),x=y==null?void 0:y.ports.find(M=>M.id===f.from.portId);y&&x&&(this.pendingLink={fromNode:y,fromPort:x,detachEdgeId:f.id},this.highlightCompatible(x.type))}}}),u.addEventListener("pointerup",p=>{if(!this.pendingLink||o.direction!=="in")return;this.pendingLink.detachEdgeId&&this.graph.removeEdge(this.pendingLink.detachEdgeId);const f=this.graph.connect({nodeId:this.pendingLink.fromNode.id,portId:this.pendingLink.fromPort.id},{nodeId:t.id,portId:o.id});this.pendingLink=null,this.clearCompatible(),f&&this.render()}),u.addEventListener("dblclick",()=>{const p=this.graph.edges.filter(y=>y.from.portId===o.id&&y.from.nodeId===t.id),f=this.graph.edges.filter(y=>y.to.portId===o.id&&y.to.nodeId===t.id);[...p,...f].forEach(y=>this.graph.removeEdge(y.id)),this.render()}),h.appendChild(u)};a.forEach(o=>r(o)),l.forEach(o=>r(o)),n.appendChild(h),e.appendChild(n),this.nodeLayer.appendChild(e),e.querySelectorAll(".port").forEach(o=>{const c=o.getBoundingClientRect(),u=this.container.getBoundingClientRect(),f=(o.classList.contains("out")?1:-1)===1?c.left-u.left+c.width-4:c.left-u.left+4,y=c.top-u.top+c.height/2;this.portPositions.set(`${t.id}:${o.dataset.portId}`,{x:f,y})})}this.renderLinks()}renderLinks(t,e){this.svg.setAttribute("width",this.container.clientWidth),this.svg.setAttribute("height",this.container.clientHeight),this.svg.innerHTML="";const i=(s,n,h="rgba(255,255,255,0.3)")=>{const a=document.createElementNS("http://www.w3.org/2000/svg","path"),l=`M${s.x},${s.y} C${s.x+60},${s.y} ${n.x-60},${n.y} ${n.x},${n.y}`;return a.setAttribute("d",l),a.setAttribute("stroke",h),a.setAttribute("fill","none"),a.setAttribute("stroke-width","2"),a.style.pointerEvents="auto",this.svg.appendChild(a),a};for(const s of this.graph.edges){const n=this.graph.nodes.find(o=>o.id===s.from.nodeId),h=this.graph.nodes.find(o=>o.id===s.to.nodeId);if(!n||!h)continue;const a=this.portPositions.get(`${n.id}:${s.from.portId}`)||this.worldToScreen({x:n.position.x+180,y:n.position.y+20}),l=this.portPositions.get(`${h.id}:${s.to.portId}`)||this.worldToScreen({x:h.position.x,y:h.position.y+20}),r=i(a,l);r.dataset.edgeId=s.id,r.addEventListener("click",()=>{this.graph.removeEdge(s.id),this.render()})}if(t&&e){const s=this.portPositions.get(`${t.fromNode.id}:${t.fromPort.id}`)||this.worldToScreen({x:t.fromNode.position.x+180,y:t.fromNode.position.y+20});i(s,e,"rgba(255,255,255,0.6)")}}highlightCompatible(t){this.nodeLayer.querySelectorAll(".port.in").forEach(e=>{e.dataset.type===t?e.classList.add("compatible"):e.classList.add("incompatible")})}clearCompatible(){this.nodeLayer.querySelectorAll(".port.in").forEach(t=>{t.classList.remove("compatible","incompatible")})}}const Mr=/^[og]\s*(.+)?/,_r=/^mtllib /,Sr=/^usemtl /,vr=/^usemap /,Ns=/\s+/,Os=new w,ki=new w,qs=new w,js=new w,Mt=new w,ei=new bt;function Ar(){const d={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&this.object.fromDeclaration===!1){this.object.name=t,this.object.fromDeclaration=e!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:e!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,n){const h=this._finalize(!1);h&&(h.inherited||h.groupCount<=0)&&this.materials.splice(h.index,1);const a={index:this.materials.length,name:s||"",mtllib:Array.isArray(n)&&n.length>0?n[n.length-1]:"",smooth:h!==void 0?h.smooth:this.smooth,groupStart:h!==void 0?h.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const r={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return r.clone=this.clone.bind(r),r}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const n=this.currentMaterial();if(n&&n.groupEnd===-1&&(n.groupEnd=this.geometry.vertices.length/3,n.groupCount=n.groupEnd-n.groupStart,n.inherited=!1),s&&this.materials.length>1)for(let h=this.materials.length-1;h>=0;h--)this.materials[h].groupCount<=0&&this.materials.splice(h,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),n}},i&&i.name&&typeof i.clone=="function"){const s=i.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(t,e){const i=parseInt(t,10);return(i>=0?i-1:i+e/3)*3},parseNormalIndex:function(t,e){const i=parseInt(t,10);return(i>=0?i-1:i+e/3)*3},parseUVIndex:function(t,e){const i=parseInt(t,10);return(i>=0?i-1:i+e/2)*2},addVertex:function(t,e,i){const s=this.vertices,n=this.object.geometry.vertices;n.push(s[t+0],s[t+1],s[t+2]),n.push(s[e+0],s[e+1],s[e+2]),n.push(s[i+0],s[i+1],s[i+2])},addVertexPoint:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,i){const s=this.normals,n=this.object.geometry.normals;n.push(s[t+0],s[t+1],s[t+2]),n.push(s[e+0],s[e+1],s[e+2]),n.push(s[i+0],s[i+1],s[i+2])},addFaceNormal:function(t,e,i){const s=this.vertices,n=this.object.geometry.normals;Os.fromArray(s,t),ki.fromArray(s,e),qs.fromArray(s,i),Mt.subVectors(qs,ki),js.subVectors(Os,ki),Mt.cross(js),Mt.normalize(),n.push(Mt.x,Mt.y,Mt.z),n.push(Mt.x,Mt.y,Mt.z),n.push(Mt.x,Mt.y,Mt.z)},addColor:function(t,e,i){const s=this.colors,n=this.object.geometry.colors;s[t]!==void 0&&n.push(s[t+0],s[t+1],s[t+2]),s[e]!==void 0&&n.push(s[e+0],s[e+1],s[e+2]),s[i]!==void 0&&n.push(s[i+0],s[i+1],s[i+2])},addUV:function(t,e,i){const s=this.uvs,n=this.object.geometry.uvs;n.push(s[t+0],s[t+1]),n.push(s[e+0],s[e+1]),n.push(s[i+0],s[i+1])},addDefaultUV:function(){const t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){const e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,i,s,n,h,a,l,r){const o=this.vertices.length;let c=this.parseVertexIndex(t,o),u=this.parseVertexIndex(e,o),p=this.parseVertexIndex(i,o);if(this.addVertex(c,u,p),this.addColor(c,u,p),a!==void 0&&a!==""){const f=this.normals.length;c=this.parseNormalIndex(a,f),u=this.parseNormalIndex(l,f),p=this.parseNormalIndex(r,f),this.addNormal(c,u,p)}else this.addFaceNormal(c,u,p);if(s!==void 0&&s!==""){const f=this.uvs.length;c=this.parseUVIndex(s,f),u=this.parseUVIndex(n,f),p=this.parseUVIndex(h,f),this.addUV(c,u,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";const e=this.vertices.length;for(let i=0,s=t.length;i<s;i++){const n=this.parseVertexIndex(t[i],e);this.addVertexPoint(n),this.addColor(n)}},addLineGeometry:function(t,e){this.object.geometry.type="Line";const i=this.vertices.length,s=this.uvs.length;for(let n=0,h=t.length;n<h;n++)this.addVertexLine(this.parseVertexIndex(t[n],i));for(let n=0,h=e.length;n<h;n++)this.addUVLine(this.parseUVIndex(e[n],s))}};return d.startObject("",!1),d}class Tr extends ji{constructor(t){super(t),this.materials=null}load(t,e,i,s){const n=this,h=new Hn(this.manager);h.setPath(this.path),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(t,function(a){try{e(n.parse(a))}catch(l){s?s(l):console.error(l),n.manager.itemError(t)}},i,s)}setMaterials(t){return this.materials=t,this}parse(t){const e=new Ar;t.indexOf(`\r
`)!==-1&&(t=t.replace(/\r\n/g,`
`)),t.indexOf(`\\
`)!==-1&&(t=t.replace(/\\\n/g,""));const i=t.split(`
`);let s=[];for(let a=0,l=i.length;a<l;a++){const r=i[a].trimStart();if(r.length===0)continue;const o=r.charAt(0);if(o!=="#")if(o==="v"){const c=r.split(Ns);switch(c[0]){case"v":e.vertices.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])),c.length>=7?(ei.setRGB(parseFloat(c[4]),parseFloat(c[5]),parseFloat(c[6])).convertSRGBToLinear(),e.colors.push(ei.r,ei.g,ei.b)):e.colors.push(void 0,void 0,void 0);break;case"vn":e.normals.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]));break;case"vt":e.uvs.push(parseFloat(c[1]),parseFloat(c[2]));break}}else if(o==="f"){const u=r.slice(1).trim().split(Ns),p=[];for(let y=0,x=u.length;y<x;y++){const M=u[y];if(M.length>0){const E=M.split("/");p.push(E)}}const f=p[0];for(let y=1,x=p.length-1;y<x;y++){const M=p[y],E=p[y+1];e.addFace(f[0],M[0],E[0],f[1],M[1],E[1],f[2],M[2],E[2])}}else if(o==="l"){const c=r.substring(1).trim().split(" ");let u=[];const p=[];if(r.indexOf("/")===-1)u=c;else for(let f=0,y=c.length;f<y;f++){const x=c[f].split("/");x[0]!==""&&u.push(x[0]),x[1]!==""&&p.push(x[1])}e.addLineGeometry(u,p)}else if(o==="p"){const u=r.slice(1).trim().split(" ");e.addPointGeometry(u)}else if((s=Mr.exec(r))!==null){const c=(" "+s[0].slice(1).trim()).slice(1);e.startObject(c)}else if(Sr.test(r))e.object.startMaterial(r.substring(7).trim(),e.materialLibraries);else if(_r.test(r))e.materialLibraries.push(r.substring(7).trim());else if(vr.test(r))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(o==="s"){if(s=r.split(" "),s.length>1){const u=s[1].trim().toLowerCase();e.object.smooth=u!=="0"&&u!=="off"}else e.object.smooth=!0;const c=e.object.currentMaterial();c&&(c.smooth=e.object.smooth)}else{if(r==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+r+'"')}}e.finalize();const n=new On;if(n.materialLibraries=[].concat(e.materialLibraries),!(e.objects.length===1&&e.objects[0].geometry.vertices.length===0)===!0)for(let a=0,l=e.objects.length;a<l;a++){const r=e.objects[a],o=r.geometry,c=r.materials,u=o.type==="Line",p=o.type==="Points";let f=!1;if(o.vertices.length===0)continue;const y=new Zt;y.setAttribute("position",new Ot(o.vertices,3)),o.normals.length>0&&y.setAttribute("normal",new Ot(o.normals,3)),o.colors.length>0&&(f=!0,y.setAttribute("color",new Ot(o.colors,3))),o.hasUVIndices===!0&&y.setAttribute("uv",new Ot(o.uvs,2));const x=[];for(let E=0,R=c.length;E<R;E++){const _=c[E],C=_.name+"_"+_.smooth+"_"+f;let T=e.materials[C];if(this.materials!==null){if(T=this.materials.create(_.name),u&&T&&!(T instanceof ni)){const v=new ni;me.prototype.copy.call(v,T),v.color.copy(T.color),T=v}else if(p&&T&&!(T instanceof Ae)){const v=new Ae({size:10,sizeAttenuation:!1});me.prototype.copy.call(v,T),v.color.copy(T.color),v.map=T.map,T=v}}T===void 0&&(u?T=new ni:p?T=new Ae({size:1,sizeAttenuation:!1}):T=new jn,T.name=_.name,T.flatShading=!_.smooth,T.vertexColors=f,e.materials[C]=T),x.push(T)}let M;if(x.length>1){for(let E=0,R=c.length;E<R;E++){const _=c[E];y.addGroup(_.groupStart,_.groupCount,E)}u?M=new Cs(y,x):p?M=new Ri(y,x):M=new Ss(y,x)}else u?M=new Cs(y,x[0]):p?M=new Ri(y,x[0]):M=new Ss(y,x[0]);M.name=r.name,n.add(M)}else if(e.vertices.length>0){const a=new Ae({size:1,sizeAttenuation:!1}),l=new Zt;l.setAttribute("position",new Ot(e.vertices,3)),e.colors.length>0&&e.colors[0]!==void 0&&(l.setAttribute("color",new Ot(e.colors,3)),a.vertexColors=!0);const r=new Ri(l,a);n.add(r)}return n}}function ve(d){const t=document.createElement("div");t.className="section";const e=document.createElement("div");return e.className="section-title",e.textContent=d,t.appendChild(e),t}class zr{constructor(t){this.container=t,this.currentNode=null,this.previewCache=new Map}async showNode(t){const e=this.container.querySelector(".node-config");if(!e)return;if(e.innerHTML="",!t){e.textContent="Select a node";return}t.kind==="data"&&!this.previewCache.has(t.id)&&await this.loadPreview(t),this.currentNode=t;const i=document.createElement("h4");i.textContent=t.label,e.appendChild(i),t.kind==="data"?this.renderDataNode(e,t):e.appendChild(document.createTextNode("No editable params."));const s=document.createElement("div");s.className="section";const n=document.createElement("button");n.textContent="Delete this node",n.addEventListener("click",()=>{var h,a;(h=window.minevisGraph)==null||h.removeNode(t.id),this.currentNode=null,this.showNode(null),(a=window.minevisEditor)==null||a.render()}),s.appendChild(n),e.appendChild(s)}async renderDataNode(t,e){var u,p,f;const i=()=>{var y;this.showNode(e),(y=window.minevisEditor)==null||y.render()},s=ve("Contract"),n=document.createElement("select");pe.list().forEach(y=>{const x=document.createElement("option");x.value=y.id,x.textContent=`${y.name}`,e.params.contractId===y.id&&(x.selected=!0),n.appendChild(x)}),n.addEventListener("change",()=>{e.params.contractId=n.value,e.params.roleMapping={},e.params.facets=[];const y=pe.get(n.value);y&&(e.label=y.name),e.runtime.updateFacets(e),i()}),s.appendChild(n),t.appendChild(s);const h=ve("Source"),a=document.createElement("input");a.value=((u=e.params.source)==null?void 0:u.path)||"",a.placeholder="File URL or relative path",a.addEventListener("input",async()=>{e.params.source={type:"file",path:a.value},await this.loadPreview(e),i()}),h.appendChild(a);const l=document.createElement("input");l.type="file",l.accept=".csv,.json,.obj,.gltf",l.addEventListener("change",async y=>{var R;const x=(R=y.target.files)==null?void 0:R[0];if(!x)return;const M=await x.text();let E=M;if(x.name.endsWith(".csv"))E=Bi.parse(M,{header:!0,dynamicTyping:!0}).data;else if(x.name.endsWith(".json"))try{E=JSON.parse(M)}catch(_){console.warn(_)}e.params.source={type:"inline",name:x.name,data:E},await this.loadPreview(e),i()}),h.appendChild(l);const r=document.createElement("div");r.className="source-preview";const o=this.previewCache.get(e.id);o!=null&&o.previewText&&(r.textContent=o.previewText),h.appendChild(r),t.appendChild(h);const c=pe.get(e.params.contractId);if(c&&e.label!==c.name&&(e.label=c.name),(c==null?void 0:c.id)==="RoadwayGeometry"){const y=document.createElement("button");y.textContent="Generate from topology binding",y.addEventListener("click",async()=>{e.params.source={type:"auto"},await this.loadPreview(e),i()}),h.appendChild(y)}if(c){const y=ve("Role Mapping"),x=this.getPreviewFields(e);c.required_roles.forEach(_=>{var S;const C=document.createElement("div");C.className="field-row";const T=document.createElement("span");T.textContent=_.label,C.appendChild(T);const v=document.createElement("div");v.className="field-control";const m=document.createElement("select");m.innerHTML='<option value="">(pick field)</option>',x.forEach(A=>{const F=document.createElement("option");F.value=A,F.textContent=A,m.appendChild(F)});const g=((S=e.params.roleMapping)==null?void 0:S[_.roleKey])||_.defaultField||"";x.includes(g)&&(m.value=g);const b=document.createElement("input");b.placeholder="Custom path",b.value=x.includes(g)?"":g,m.addEventListener("change",()=>{e.params.roleMapping=e.params.roleMapping||{},e.params.roleMapping[_.roleKey]=m.value,b.value="",i()}),b.addEventListener("input",()=>{e.params.roleMapping=e.params.roleMapping||{},e.params.roleMapping[_.roleKey]=b.value,m.value="",i()}),v.appendChild(m),v.appendChild(b),C.appendChild(v),y.appendChild(C)}),t.appendChild(y);const M=ve("Binding");c.binding_requirements.forEach(_=>{var m;const C=document.createElement("label");C.className="field-row",C.innerHTML=`<span>${_.description||`${_.fromRoleKey}  ${_.toRoleKey}`}</span>`;const T=document.createElement("select");T.innerHTML='<option value="">(none)</option>',(((m=window.minevisGraph)==null?void 0:m.nodes.filter(g=>{var b;return((b=g.params)==null?void 0:b.contractId)===_.toContractId}))||[]).forEach(g=>{var S;const b=document.createElement("option");b.value=g.id,b.textContent=`${g.label} (${_.toContractId})`,((S=e.bindings)==null?void 0:S[_.fromRoleKey])===g.id&&(b.selected=!0),T.appendChild(b)}),T.addEventListener("change",async()=>{e.bindings=e.bindings||{},e.bindings[_.fromRoleKey]=T.value,await this.loadPreview(e),i()}),C.appendChild(T),M.appendChild(C)}),t.appendChild(M);const E=ve("Facets / Outputs"),R=document.createElement("div");if(R.className="facet-list",(p=e.params.facets)==null||p.forEach(_=>{const C=document.createElement("div");C.className="facet-row",C.textContent=`${_.facetType}: ${_.label}`,R.appendChild(C)}),!((f=e.params.facets)!=null&&f.length)){const _=document.createElement("button");_.textContent="Reset default facets",_.addEventListener("click",()=>{e.runtime.updateFacets(e),i()}),R.appendChild(_)}E.appendChild(R),t.appendChild(E)}}getPreviewFields(t){const e=this.previewCache.get(t.id);return e!=null&&e.fields?e.fields:[]}async loadPreview(t){var a,l;let e=null;const i=t.params.source||{};if(i.type==="inline")e=i.data;else if(i.path)try{if(i.path.endsWith(".csv")){const r=await fetch(i.path).then(o=>o.text());e=Bi.parse(r,{header:!0,dynamicTyping:!0}).data}else i.path.endsWith(".obj")?e=await fetch(i.path).then(o=>o.text()):e=await fetch(i.path).then(r=>r.json())}catch(r){console.warn("Preview load failed",r)}if(!e)return;let s=e;if(typeof e=="string"&&((a=i.name)!=null&&a.endsWith(".obj")||(l=i.path)!=null&&l.endsWith(".obj"))){const r=new Tr;try{const o=r.parse(e),c=[];o.traverse(u=>{u.isMesh&&c.push({name:u.name||"Unnamed"})}),c.length||c.push({name:"Model_Root"}),s=c}catch(o){console.warn("OBJ Parse error in inspector",o),s=[]}}const n=this.collectFields(s),h=Array.isArray(s)?JSON.stringify(s.slice(0,3),null,2):JSON.stringify(s,null,2).slice(0,200)+"...";this.previewCache.set(t.id,{fields:n,previewText:h})}collectFields(t){const e=new Set,i=n=>{n&&e.add(n)},s=(n,h="")=>{!n||typeof n!="object"||Object.keys(n).forEach(a=>{const l=n[a],r=h?`${h}.${a}`:a;i(r),l&&typeof l=="object"&&!Array.isArray(l)&&s(l,r)})};return Array.isArray(t)?t.slice(0,5).forEach(n=>s(n)):t!=null&&t.nodes||t!=null&&t.edges?((t.nodes||[]).slice(0,5).forEach(n=>s(n)),(t.edges||[]).slice(0,5).forEach(n=>s(n))):t&&typeof t=="object"&&s(t),Array.from(e)}}const Er=document.querySelector("#app");Er.innerHTML=`
  <div id="layout" class="fill-layout">
    <header>
      <div>
        <h2>MineVis Editor</h2>
        <p class="small">Configure data contracts and function wiring, then open preview.</p>
      </div>
      <div class="actions">
        <div class="palette">
          <label>Add node
            <select id="node-library"></select>
          </label>
          <button id="btn-add-node">Add</button>
        </div>
        <button id="btn-save">Save graph.json</button>
        <button id="btn-open-preview">Open Preview Window</button>
      </div>
    </header>
    <main>
      <section id="editor" class="panel fill"></section>
      <section id="inspector" class="panel inspector-panel">
        <h3>Inspector</h3>
        <div class="node-config"></div>
      </section>
    </main>
  </div>
`;const ai=new fr;[...Yn,...pr].forEach(d=>ai.register(d));const at=new br(ai);function Cr(){const d=at.createNode("DataNode",{x:60,y:60});d.params=Qe("RoadwayTopology",{path:"/data/roadway_topo.json"}),d.runtime.updateFacets(d);const t=at.createNode("DataNode",{x:60,y:220});t.params=Qe("RoadwayGeometry",{path:"/data/roadway_model.obj"}),t.bindings={topo_ref_id:d.id},t.runtime.updateFacets(t);const e=at.createNode("DataNode",{x:60,y:380});e.params=Qe("SensorStationRegistry",{path:"/data/temperature_sensors.csv"}),e.runtime.updateFacets(e);const i=at.createNode("DataNode",{x:360,y:380});i.params=Qe("SensorReadingTimeSeries",{path:"/data/Temperature_timeseries_20steps.csv"}),i.bindings={sensor_id:e.id},i.runtime.updateFacets(i);const s=at.createNode("SensorDetailFunction",{x:660,y:220}),n=at.createNode("RoadwayTempSnapshotFunction",{x:660,y:380});at.connect({nodeId:d.id,portId:"facet-graph"},{nodeId:n.id,portId:"roadwayTopo"}),at.connect({nodeId:t.id,portId:"facet-meshParts"},{nodeId:n.id,portId:"roadwayMesh"}),at.connect({nodeId:t.id,portId:"facet-meshParts"},{nodeId:s.id,portId:"roadwayMesh"}),at.connect({nodeId:e.id,portId:"facet-registry"},{nodeId:s.id,portId:"sensorRegistry"}),at.connect({nodeId:e.id,portId:"facet-registry"},{nodeId:n.id,portId:"sensorRegistry"}),at.connect({nodeId:i.id,portId:"facet-series"},{nodeId:s.id,portId:"tempReadings"}),at.connect({nodeId:i.id,portId:"facet-snapshot"},{nodeId:n.id,portId:"tempReadings"})}Cr();const ye=new wr(document.querySelector("#editor"),at),Js=new zr(document.querySelector("#inspector"));ye.onSelect=d=>Js.showNode(d);ye.onDelete=()=>Js.showNode(null);ye.render();window.minevisEditor=ye;window.minevisDefaultStops=tr;const Ui=document.querySelector("#node-library"),Fr=document.querySelector("#btn-add-node"),Ii={data:ai.list().filter(d=>d.kind==="data"),function:ai.list().filter(d=>d.kind==="function")};Ui.innerHTML="";for(const d of Object.keys(Ii)){if(!Ii[d].length)continue;const t=document.createElement("optgroup");t.label=d.toUpperCase(),Ii[d].forEach(e=>{const i=document.createElement("option");i.value=e.typeId,i.textContent=e.label,t.appendChild(i)}),Ui.appendChild(t)}Fr.addEventListener("click",()=>{const d=Ui.value;if(!d)return;const t=document.querySelector("#editor").getBoundingClientRect(),e=ye.screenToWorld({x:t.width/2,y:t.height/2}),i=at.createNode(d,{x:e.x,y:e.y});d==="DataNode"&&i.runtime.updateFacets(i),ye.render()});document.querySelector("#btn-save").addEventListener("click",()=>{const d=at.serialize(),t=new Blob([d],{type:"application/json"}),e=URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download="graph.json",i.click(),URL.revokeObjectURL(e)});document.querySelector("#btn-open-preview").addEventListener("click",()=>{const d=at.serialize(),t=window.open("/preview.html","minevis-preview"),e=()=>{try{t==null||t.postMessage({type:"minevis-graph",payload:d},window.location.origin)}catch(i){console.warn("Failed to post graph to preview",i)}};t&&(t.onload=e,setTimeout(e,500))});window.minevisGraph=at;window.minevisRegistry=new tn;
